# React

Create time: February 19, 2022 11:47 PM
Description: ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“
Last edited time: July 5, 2022 11:07 AM
Logo: React%20068a8677f1874d7d8beabb6002f19b86/React.png
Official website: https://react.docschina.org/

[redux react-redux](https://www.notion.so/redux-react-redux-62bfa339daba48138b23b8500121c05d)

[react-router-dom](https://www.notion.so/react-router-dom-3148f91f87a345f6bf9b275d06a6c75f)

[reactä¸­webpackçš„é…ç½®](https://www.notion.so/react-webpack-fdfc98bf35ce45aea38c1deb844bd366)

[reactä¸tsçš„èåˆä½¿ç”¨](https://www.notion.so/react-ts-2340d62713b2413aa6c269ccd8fa79b6)

[reactä¸­cssè§£å†³: css modules](https://www.notion.so/react-css-css-modules-48dd47faef804ee5b8a51bc95180074f)

[reacté¡¹ç›®æ‰“åŒ…ä¼˜åŒ–](https://www.notion.so/react-20dc6bf2f8834b7d90000377d27d0b89)

[Reacté¡¹ç›®ä¸­çš„é—®é¢˜](https://www.notion.so/React-9f97dd4b9a454c08926f0f1f0df1cc2a)

[reactç¬¬ä¸‰æ–¹åº“](https://www.notion.so/react-e1ef988c4cf3476fa2e48ac004eb5461)

<aside>
ğŸ’¡ Reactæ˜¯**ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“**, ç”±facebookå¼€æº, æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆå¿…é¡»è¦æŒæ¡çš„æ¡†æ¶

</aside>

# Reactç®€ä»‹

- reactçš„ä¸‰å¤§ç‰¹æ€§: å£°æ˜å¼ ç»„ä»¶åŒ– è·¨å¹³å°
    
    å£°æ˜å¼: æ•°æ®é©±åŠ¨è§†å›¾, æ•°æ®å˜åŠ¨æ—¶ React èƒ½é«˜æ•ˆæ›´æ–°å¹¶æ¸²æŸ“åˆé€‚çš„ç»„ä»¶ã€‚
    
    ç»„ä»¶åŒ–: æ„å»ºç®¡ç†è‡ªèº«çŠ¶æ€çš„å°è£…ç»„ä»¶ï¼Œç„¶åå¯¹å…¶ç»„åˆä»¥æ„æˆå¤æ‚çš„ UIã€‚
    
    è·¨å¹³å°: 
    
    1. react-dom(webç«¯) react-native(ç§»åŠ¨ç«¯) react-reavt360(VR), 
    2. æ— è®ºé¡¹ç›®ç°åœ¨çš„æŠ€æœ¯æ ˆæ˜¯ä»€ä¹ˆ, éƒ½å¯ä»¥é€šè¿‡å¼•å…¥ React æ¥å¼€å‘æ–°åŠŸèƒ½
- reactå…ƒç´ : reactæ¸²æŸ“è§†å›¾çš„æœ€å°å•ä½
    
    åœ¨reactä¸­, React å…ƒç´ æ˜¯åˆ›å»ºå¼€é”€æå°çš„JavaScriptå¯¹è±¡, æ˜¯æ¸²æŸ“è§†å›¾çš„æœ€å°å•ä½
    
    - å¦‚ä½•åˆ›å»ºReactå¯¹è±¡?
        
        ```jsx
        import React from 'react'
        let el = React.createElement(
          'h1', // èŠ‚ç‚¹çš„ç±»å‹
          { className: 'title', data: 'react-css' }, // èŠ‚ç‚¹æ‰€æ‹¥æœ‰çš„å±æ€§
          'Hello, world!' // èŠ‚ç‚¹çš„å†…å®¹æˆ–å­èŠ‚ç‚¹
        )
        ```
        
    - `React.crateElement` ä¼šé¢„å…ˆæ£€æŸ¥ä»£ç é”™è¯¯.ç„¶ååˆ›å»ºä¸€ä¸ªJavaScriptå¯¹è±¡.
        
        ```jsx
        // æ³¨æ„ï¼šè¿™æ˜¯ç®€åŒ–è¿‡çš„ç»“æ„
        constÂ  el =
        {
        	type:'h1', // èŠ‚ç‚¹ç±»å‹
        	props:{    // èŠ‚ç‚¹æ¥æ”¶çš„å±æ€§
        		className:'greeting',
        		children:'Hello, world!' // å­èŠ‚ç‚¹çš„å†…å®¹, å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ˜¯å…¶ä»–elèŠ‚ç‚¹
        	}
        }
        ```
        
- `react-dom`åº“: é€šè¿‡ `ReactDOM.render` å°†reactå…ƒç´ ç”ŸæˆçœŸå®çš„DOMå…ƒç´ ,å¹¶ä¸”æ¸²æŸ“å‡ºæ¥
    
    ```jsx
    import React from 'react'
    import ReactDOM from 'react-dom' 
    		 
    // 1.ç”Ÿæˆreactå…ƒç´ 
    let li = 'hello,world'
    let el = React.createElement(
      'h1',
      { className: 'title', data: 'react-css' },
      li,
    )
    
    // 2.è°ƒç”¨ReactDOM.renderæ¥æ¸²æŸ“UI
    ReactDOM.render(el, document.getElementById('root'))
    ```
    

# JSXçš„ä½¿ç”¨

reacté¡¹ç›®å¼€å‘è„šæ‰‹æ¶å‘½ä»¤ `npx create-react-app é¡¹ç›®åç§°`

- JSXæ˜¯JavaScriptè¯­æ³•çš„æ‰©å±•, æœ¬è´¨ä¸Šä¾ç„¶æ˜¯JavaScript
    
    JSXåƒæ¨¡æ¿è¯­æ³•, ä½†å®ƒå…·æœ‰JSçš„å…¨éƒ¨åŠŸèƒ½, å› ä¸ºreact.createElement()åˆ›å»ºå…ƒç´ è¿‡äºç¹ç, æ‰€ä»¥å‘æ˜JSXå†™æ¥XML. è¿™å°±æ˜¯JSX. 
    
    JSXæ˜¯é€šè¿‡ `Babel` æ¥è½¬è¯‘æˆÂ React.createElement()Â å‡½æ•°è°ƒç”¨ã€‚
    
- JSXä¸­åµŒå…¥è¡¨è¾¾å¼
    
    ### åœ¨ JSX è¯­æ³•ä¸­ï¼Œå¯ä»¥åœ¨å¤§æ‹¬å·å†…æ”¾ç½®ä»»ä½•æœ‰æ•ˆçš„JSè¡¨è¾¾å¼
    
    ```jsx
    	 (JSè¡¨è¾¾å¼: ä»»ä½•å€¼æˆ–è€…æœ€ç»ˆé€šè¿‡è®¡ç®—è¿”å›ä¸€ä¸ªå€¼, å¯ä»¥é€šè¿‡console.log()æ‰“å°çš„éƒ½æ˜¯è¡¨è¾¾å¼)
    	let name = ' wx '
    	let el = <h1> ä½ å¥½,{name} </h1>
    	ReactDOM.render(
    	  el ,
    	  document.getElementById('root')
    	);
    { /* è¿™æ˜¯æ³¨é‡Š */ }
    ```
    
    ### JSXæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼
    
    ç¼–è¯‘åJSXä¼šæ˜¯ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨(`React.createElement`), å–å€¼åå¾—åˆ°ä¸€ä¸ªæ™®é€šJSå¯¹è±¡, æ‰€ä»¥,å¯ç”¨é€šè¿‡æ“ä½œå¯¹è±¡ä¸€æ ·ä½¿ç”¨JSX (æ¯”å¦‚å‡½æ•°ä¸­è¿”å›ä¸€æ®µJSX).
    
    ```jsx
    function () {
    	return <div>123</div>
    }
    ```
    
    ### JSXä¸­çš„ç‰¹å®šå±æ€§
    
    ```jsx
    1. é€šè¿‡ä½¿ç”¨å¼•å·ï¼Œæ¥å°†å±æ€§å€¼æŒ‡å®šä¸ºå­—ç¬¦ä¸²å­—é¢é‡
    let el = <h1 className='title'> ä½ å¥½,{ name } </h1>
    	
    2. é€šè¿‡å¤§æ‹¬å·{} ,å¯åœ¨å±æ€§å€¼ä¸­æ’å…¥JSè¡¨è¾¾å¼
    import logo from './logo.png'
    let img = <img src={ logo }></img>
    ```
    
- JSXä½¿ç”¨çš„æ³¨æ„äº‹é¡¹(reactä¸­)
    1. å¿…é¡»è¦å¯¼å…¥react, å› ä¸ºJSXæœ¬è´¨ä¸Šæ˜¯react.createElement(), (react17ç‰ˆæœ¬å,å¯ä»¥ä¸éœ€è¦å¯¼å…¥)
    2. å¿…é¡»è¦æœ‰ä¸€ä¸ªæ ¹å…ƒç´ åŒ…è£¹èµ·æ¥, reactæ”¯æŒ<></>åŒ…è£¹(å¹½çµèŠ‚ç‚¹,ä¼šè¢«è§£ææˆ<React.Fragment>)
    3. æ ‡ç­¾å¿…é¡»é—­åˆ!!!
    4. JSXæ›´æ¥è¿‘JavaScript, classå±æ€§è¦æ°¸className,forå±æ€§è¦ä½¿ç”¨htmlFor( <label htmlFor/> )
    5. æ¢è¡Œæ—¶æœ€å¥½ç”¨æ‹¬å·()åŒ…è£¹èµ·æ¥, ä»¥é˜²æ­¢æ„å¤–çš„bug
- JSXä¸­å®Œæˆ `vue` çš„å„ç§è¯­æ³•ç³– `v-if v-for classå’Œstyleçš„å¤„ç†`
    
    ### æ¡ä»¶æ¸²æŸ“ ( if/else , ä¸‰å…ƒè¿ç®—ç¬¦, && æ¥å®Œæˆæ¡ä»¶æ¸²æŸ“)
    
    1. if/else
        
        ```jsx
        let loading = true
        const reactH = loading => {
          if (loading) {
            return <li>loadingä¸ºtrue</li>
          } else {
            return <div>loadingä¸ºfalse</div>
          }
        }
        ```
        
    2. ä¸‰å…ƒè¿ç®—
        
        ```jsx
        *const* el = <div>{loading ? <div>æ­£åœ¨åŠ è½½ä¸­...</div> : <div>åŠ è½½å®Œæˆ</div>}</div>
        ```
        
    3. é€»è¾‘è¿ç®—
        
        ```jsx
        *const* element = loading && <div>æ­£åœ¨åŠ è½½ä¸­...</div>
        ```
        
    
    ### åˆ—è¡¨æ¸²æŸ“ (ä½¿ç”¨Array.map: ä¸æ”¹å˜åŸå€¼, ä¸”ä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„)
    
    ```jsx
    const list = ['å¤ªé˜³', 'æœˆäº®', 'æ˜Ÿæ˜Ÿ']
    const dom = (
      <ul>
        {list.map((item, index) => {
          return <li key={index}> { item } </li> 
    			// éœ€è¦ä½¿ç”¨keyæ¥è¿›è¡Œå”¯ä¸€æ ‡è¯†, æ–¹ä¾¿æ›´æ–°æ—¶èŠ‚çœæ€§èƒ½ diffæ›´æ–°
        })}
      </ul>
    )
    ```
    
    ### æ ·å¼å¤„ç†
    
    1. styleå¿…é¡»è¦æ˜¯å¯¹è±¡ ä¸èƒ½æ˜¯å­—ç¬¦ä¸²
    2. å¯¼å…¥cssæ–‡ä»¶ è®¾ç½®className
    
    ```jsx
    const div = (
      <ul>
        {list.map((item, index) => (
          <li key={index} style={{ fontSize: 30, color: 'red' }}>
            {item}
          </li>
        ))}
      </ul>
    )
    ```
    
- ä½¿ç”¨ `classnames` åº“æ¥å¤„ç† classæ ·å¼
    
    ```jsx
    import classNames from 'classnames'
    // classNamesæ˜¯ä¸€ä¸ªå‡½æ•° ---  å’Œvueçš„classç”¨æ³•è¾ƒä¸ºç›¸ä¼¼
     <span className={classNames('hate', { 'hated': item.attitude === -1 })}
     onClick={() => clickIcon(item.id, item.attitude === -1 ? 0 : -1)} />
    ```
    

# ç»„ä»¶å’Œç»„ä»¶çŠ¶æ€

- reactä¸­ç»„ä»¶ä½¿ç”¨è§„èŒƒ
    1. ç»„ä»¶åç§°å¿…é¡»å¤§å†™å­—æ¯å¼€å¤´, å°å†™è§†ä¸ºåŸç”ŸDOMå¯¹è±¡
    2. å¿…é¡»æœ‰è¿”å›å€¼, æ²¡å†…å®¹è¿”å› `null`
- **å‡½æ•°ç»„ä»¶**: å‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ, æ¶ˆè€—æ›´å°,æ¸²æŸ“æ›´å¿«.
    
    ```jsx
    // 1. functionå£°æ˜
    function Open(props) {
      return <h1>react,{props.name}</h1>
    }
    // 2.ç®­å¤´å‡½æ•°
    const FnCom = () => <div>div</div>
    
    ReactDOM.render(
      <Open name='å°ç‹'/>,
      document.getElementById('root')
    )
    ```
    
- **ç±»ç»„ä»¶**:
    
    ```jsx
    import React, { Component } from 'react'
    class Open extends Component {
      render() {
        return <h1>Hello, {this.props.name}</h1>;
      }
    }
    ReactDOM.render(
      <Open name='å°ç‹'/>,
      document.getElementById('root')
    )
    ```
    
- ç»„åˆç»„ä»¶: ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶å¯ä»¥ç»“åˆä½¿ç”¨
    
    ```jsx
    class Open extends React.Component {
      render() {
        return <h1>Hello, {this.props.name}</h1>;
      }
    }
    function App() {
      return  <div>
        <Open name='å“ˆå“ˆ'></Open>
        <Open name='wx'></Open>
        <Open name='66'></Open>
      </div>
    }
    ReactDOM.render(
      <App/>,
      document.getElementById('root')
    )
    ```
    
- **ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„åŒºåˆ«**
    1. å‡½æ•°ç»„ä»¶ä¹Ÿå«æ— çŠ¶æ€ç»„ä»¶,ä¸èƒ½è‡ªå·±æä¾›çŠ¶æ€ (react 16.8ç‰ˆæœ¬ hookså‡ºç°ä¹‹å‰)
    2. ç±»ç»„ä»¶åˆå«æœ‰çŠ¶æ€ç»„ä»¶ å¯ä»¥è‡ªå·±æä¾›æ•°æ®. çŠ¶æ€å°±æ˜¯ ç»„ä»¶çš„ç§æœ‰æ•°æ®,æ•°æ®å˜åŒ–,çŠ¶æ€æ›´æ–°
    3. hooksä¹‹å‰, ç±»ç»„ä»¶æ¯”å‡½æ•°ç»„ä»¶åŠŸèƒ½æ›´å¼ºå¤§ hooksä¹‹å,åŠŸèƒ½ç›¸åŒ

# ç±»ç»„ä»¶: æä¾›å’Œä¿®æ”¹ç»„ä»¶çŠ¶æ€

- æä¾›çŠ¶æ€:  æä¾› `state` é€šè¿‡ `this.state.xxx` è®¿é—®
    
    ```jsx
    class Demo extends Component {
      state = {  // state æä¾›çŠ¶æ€
        count: 0,
        name: 'x2',
        salary: 100,
        list: ['test', 'demo'],
      }
      render() {
        return (
          <div>
            <p>æ•°é‡:{this.state.count}</p>
            <p>é‡‘é’±:{this.state.salary}</p>
            <ul>
              {this.state.list.map((item, index) => (
                <li key={index}>{item}</li>
              ))}
            </ul>
          </div>
        )
      }
    }
    
    // å®Œæ•´å†™æ³•
    class Parent extends React.Component{
        constructor(props){ // æä¾›constructor, è°ƒç”¨super()
            super(props)
            this.state = {name:'frank'}
        }
        onClick = () => {
            render(){
                return <B name={this.state.name} onClick={this.onClick}>hi</B>
            }
        }
    		render() {
    			return <div>Parentç»„ä»¶</div>
    		}
    }
    ```
    
- æ³¨å†Œäº‹ä»¶: ä¿®æ”¹ç»„ä»¶çŠ¶æ€ + è·å–äº‹ä»¶å¯¹è±¡
    
    ```jsx
    render() {
        return (
          <div>
            <p>
              æ•°é‡:{this.state.count}{' '}
              **<a onClick={this.addCount} href='http://www.baidu.com'> 
    						// æ³¨æ„è¿™æ®µä»£ç å®é™…ä¸Šæœ‰é—®é¢˜, thisçš„æŒ‡å‘é—®é¢˜**
                ç‚¹å‡»
              </a>
            </p>
            <p>é‡‘é’±:{this.state.salary}</p>
            <ul>
              {this.state.list.map((item, index) => (
                <li key={index}>{item}</li>
              ))}
            </ul>
          </div>
        )
      }
      // è·å–äº‹ä»¶å¯¹è±¡
      addCount(e) {
        e.preventDefault()
        e.stopPropagation()
        console.log('ç‚¹å‡»äº‹ä»¶')
        // this.state.count++
      }
    }
    ```
    
- **classç»„ä»¶ä¸­çš„ `this` æŒ‡å‘é—®é¢˜**
    
    ### å›é¡¾thisæŒ‡å‘é—®é¢˜:  `this` çš„æŒ‡å‘å’Œè°ƒç”¨æ–¹å¼æœ‰å…³
    
    1. å‡½æ•°è°ƒç”¨æ¨¡å¼ä¸‹, åŒ¿åå‡½æ•°,å®šæ—¶å™¨, thisæŒ‡å‘windowå¯¹è±¡(éä¸¥æ ¼æ¨¡å¼ä¸‹)
    2. æ–¹æ³•è°ƒç”¨æ¨¡å¼ä¸‹, thisæŒ‡å‘è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡
    3. äº‹ä»¶å¤„ç†å‡½æ•°ä¸­, thisæŒ‡å‘è§¦å‘äº‹ä»¶çš„å½“å‰å…ƒç´ 
    4. æ„é€ å‡½æ•°è°ƒç”¨ä¸‹, thisæŒ‡å‘æ–°åˆ›å»ºçš„å®ä¾‹
    5. ç®­å¤´å‡½æ•°ä¸­æ²¡æœ‰thisæŒ‡å‘é—®é¢˜, thiså§‹ç»ˆå’Œçˆ¶çº§ä½œç”¨åŸŸä¿æŒä¸€è‡´
    6. ä¸Šä¸‹æ–‡è°ƒç”¨æ¨¡å¼ä¸‹:
        1. callå’Œapplyæ–¹æ³•ä¸­, thisæŒ‡å‘æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°. 
        2. bindæ–¹æ³•ä¸­,bindåˆ›å»ºçš„æ–°å‡½æ•°çš„thisç»‘å®šä¸ºbindæ–¹æ³•ä¸­æ–°çš„å‡½æ•°
    
    ### Reactä¸­classç»„ä»¶çš„ `this` é—®é¢˜
    
    1. åœ¨reactä¸­ `render`å‡½æ•°ä¸­ `this` æ²¡æœ‰é—®é¢˜, æŒ‡å‘reactå½“å‰ç»„ä»¶, åªæœ‰äº‹ä»¶ä¸­çš„ `this` å­˜åœ¨é—®é¢˜,æŒ‡å‘  `undefined`
    2. renderä¸­å‡½æ•°æ˜¯ç›´æ¥è¢«reactç»„ä»¶è°ƒç”¨çš„, thisæŒ‡å‘å½“å‰reactç»„ä»¶
    3. äº‹ä»¶è¢«èµ‹å€¼ç»™onClick onClickè°ƒç”¨thisä¸ºundefined
    
- è§£å†³classç»„ä»¶çš„ `this` æŒ‡å‘é—®é¢˜
    1. åœ¨ç®­å¤´å‡½æ•°ä¸­è°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•°, ç¼ºç‚¹ç»“æ„ä¸å¥½ æ³¨æ„äº‹ä»¶å¯¹è±¡
        
        ```jsx
        <a onClick={(e) => {
             this.addCount(e)
           }}
            href='http://www.baidu.com'>
            ç‚¹å‡»
          </a>
        ```
        
    2. bindç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°æ”¹å˜thisæŒ‡å‘:  ä¸ä½¿ç”¨callå’Œapply, ä¼šè°ƒç”¨è¯¥å‡½æ•°
        
        ```jsx
        <a onClick={this.addCount().bind(this)} >
        	  ç‚¹å‡»
        </a>
        ```
        
    3. ç›´æ¥å°†äº‹ä»¶å‡½æ•°å†™ä¸ºç®­å¤´å‡½æ•° (æ¨èæ­¤å†™æ³•// å®éªŒæ€§è¯­æ³•,é€šè¿‡Babelè½¬ä¹‰)  classä¸­å†™ç®­å¤´å‡½æ•°
        
        ```jsx
        addCount = (e) => {
            e.preventDefault()
            e.stopPropagation()
            console.log('ç‚¹å‡»äº‹ä»¶')
            // this.state.count++ 
        		// è¿™é‡Œå¦‚ä½•ä¿®æ”¹stateçŠ¶æ€ ?? 
          }
        ```
        
- ä¿®æ”¹ `state` çŠ¶æ€: ä½¿ç”¨ `setState` æ–¹æ³•
    
    Reactä¸­ç›´æ¥ä¿®æ”¹æ•°æ®å¹¶ä¸ä¼šé€ æˆDOMä¸»åŠ¨æ›´æ–°
    
    å¿…é¡»é€šè¿‡è°ƒç”¨this.setStateæ–¹æ³•æ¥ä¿®æ”¹stateçš„çŠ¶æ€,åŒæ—¶Reactä¼šè§¦å‘DOMè‡ªåŠ¨æ›´æ–°
    
    ```jsx
    addCount = e => {
      e.preventDefault()
      this.setState({
        count: this.state.count + 1,
      })
    }
    ```
    
- Reactæ ¸å¿ƒç†å¿µ: **çŠ¶æ€ä¸å¯å˜! ä¸è¦ç›´æ¥ä¿®æ”¹çŠ¶æ€,è€Œæ˜¯åˆ›å»ºæ–°çš„çŠ¶æ€å€¼æ›¿æ¢åŸæ¥çš„çŠ¶æ€**
    
    ```jsx
    addCount = e => {
      e.preventDefault()
      this.setState({
    		...this.state,
        count: this.state.count + 1,
      })
    }
    ```
    

# ç±»ç»„ä»¶: æ§åˆ¶è¡¨å•

**Reactä¸­æœ‰ä¸¤ç§æ§åˆ¶è¡¨å•çš„æ–¹æ³•**

- å—æ§ç»„ä»¶(æ¨è)
    - è¡¨å•å…ƒç´ çš„valueå€¼å—åˆ°reactç»„ä»¶çŠ¶æ€çš„æ§åˆ¶
    - å¿…é¡»æä¾›onChangeäº‹ä»¶. ä½¿è¡¨å•å®Œå…¨å—åˆ°stateçš„æ§åˆ¶
    
    ```jsx
    	state = {
        value: '13',
        isDog: false,
      }
      render() {
        return (
          <div>
            <div>å—æ§ç»„ä»¶</div>
            <input
              type='text'
              value={this.state.value}
              onChange={this.handerChange}
            />
            <label htmlFor='isDog'>æ˜¯å¦å•èº«</label>
            <input
              type='checkbox'
              id='isDog'
              checked={this.state.isDog}
              onChange={this.handleDog}
            />
          </div>
        )
      }
      handerChange = e => {
        this.setState({
          value: e.target.value,
        })
      }
      handleDog = e => {
        this.setState({
          isDog: e.target.checked,
        })
      }
    ```
    
- éå—æ§ç»„ä»¶(ä¸æ¨è, é€‚åˆç”¨æ¥è°ƒç”¨ç»„ä»¶çš„æ–¹æ³•)
    - é€šè¿‡ `createRef` åˆ›å»º `ref` å¯¹è±¡æ¥è·å–DOM, æ“ä½œåŸç”ŸDOMçš„æ–¹å¼æ¥æ›´æ–°æ•°æ®.
    - é€šè¿‡è°ƒç”¨ `ref` çš„ `current` å±æ€§å¯è·å–å½“å‰å…ƒç´ /ç»„ä»¶
    
    ```jsx
    import React, { Component, createRef } from "react"
    	import ReactDOM from "react-dom"
    	
    	class App extends Component {
    	  state = {
    	    value: '',
    	    checked: false
    	  }
    	  oneRef = createRef()
    	  render () {
    	    return (
    	      <div>
    	        <p>å—æ§ç»„ä»¶(æ¨è)</p>
    	        å§“å <input type='text' value={this.state.value} onChange={this.handleInput} />
    	        <p>éå—æ§ç»„ä»¶,ä½¿ç”¨refè·å–ç»„ä»¶æˆ–dom</p>
    	        <label htmlFor="checkbox"> æ˜¯å¦å•èº« </label>
    	        <input id="checkbox" type='checkbox' ref={this.oneRef} onChange={this.handleCheckbox}></input>
    	      </div>
    	    )
    	  }
    	  handleInput = (e) => {
    	    this.setState({
    	      value: e.target.value
    	    })
    	  }
    	  handleCheckbox = () => {
    	    this.setState({
    	      checked: this.oneRef.current.checked
    	    })
    	  }
    	}
    	ReactDOM.render(<App></App>, document.querySelector('#root'))
    ```
    

# ç±»ç»„ä»¶: äº‹ä»¶å‡½æ•°ä¼ å‚

- bindç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°: bindæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ç»‘å®šthis, åç»­å‚æ•°ä½œä¸ºæ–°å‡½æ•°çš„å…¥å‚
    
    ```jsx
    onClick={this.clickTab.bind(this,item.type)}
    
    clickTab = (type) => {
        this.setState({
    			active: type
        })
    }
    ```
    
- åœ¨ç®­å¤´å‡½æ•°ä¸­è°ƒç”¨ä¼ å‚çš„äº‹ä»¶å¤„ç†å‡½æ•°: ä¸èƒ½åœ¨renderæ‰§è¡Œæ—¶ç›´æ¥è°ƒç”¨å‡½æ•°
    
    ```jsx
    onClick={() => this.delItem(item.id)}
    
    delItem = (id) => {
      this.setState({
        list: this.state.list.filter(item => item.id !== id)
      })
    }
    ```
    

# ç»„ä»¶é€šè®¯

æ‰“ç ´ç»„ä»¶é—´çš„å°é—­æ€§, è®©å…¶ä¸å¤–ç•Œå…±äº«æ•°æ®

- `props` çš„åŸºæœ¬ä½¿ç”¨
    
    `props`æ˜¯åªè¯»å¯¹è±¡, çˆ¶ç»„ä»¶çš„æ•°æ®æ›´æ–°ä¼šæµåˆ°å­ç»„ä»¶,å­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®. è¦ç¬¦åˆ `å•é¡¹æ•°æ®æµ`
    
    1. å‡½æ•°ç»„ä»¶: é€šè¿‡å‡½æ•°å…¥å‚ è·å–props
        
        ```jsx
        function App ( props ) {
           return (
             <div>
               æˆ‘æ˜¯Appç»„ä»¶
               <p>åç§°: {props.name} </p>
               <p>èº«é«˜: {props.length || 170} </p>
             </div>
           )
        }
        
        ReactDOM.render(<App name='appppp' length={190} />, document.getElementById('root'))
        ```
        
    2. classç»„ä»¶: é€šè¿‡ `this.props` è·å–çˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®
        
        ```jsx
        class App extends Component {
          render () {
            return (
              <div>
                æˆ‘æ˜¯Appç»„ä»¶
                <p> name: { this.props.name } </p>
                <p> length: { this.props.weight } </p>
              </div>
            )
          }
        }
        
        ReactDOM.render(<App name='appppp' length={190} />, document.getElementById('root'))
        ```
        
    
- `**props` çš„ `children` å±æ€§**
    1. childrenå±æ€§ï¼šè¡¨ç¤ºè¯¥ç»„ä»¶çš„å­èŠ‚ç‚¹ï¼Œåªè¦ç»„ä»¶æœ‰å­èŠ‚ç‚¹ï¼Œpropså°±æœ‰è¯¥å±æ€§
    2. children å±æ€§ä¸æ™®é€šçš„propsä¸€æ ·ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„å€¼ï¼ˆæ–‡æœ¬ã€Reactå…ƒç´ ã€ç»„ä»¶ï¼Œç”šè‡³æ˜¯å‡½æ•°ï¼‰
    3. ä¾‹å­
        
        ```jsx
        function Hello (props) {
          return (
            <div>
              è¯¥ç»„ä»¶çš„å­èŠ‚ç‚¹ï¼š{props.children}
            </div>
          )
        }
        ReactDOM.render(<Hello>æˆ‘æ˜¯å­èŠ‚ç‚¹</Hello>, document.getElementById('root'))
        ```
        
- çˆ¶ä¼ å­
    
    ```jsx
    // æ²¡æœ‰é€»è¾‘ å»ºè®®ä½¿ç”¨å‡½æ•°ç»„ä»¶
    `Son.jsx`
    function Son (props) {
      return (
        <li className='child'>
          <p>åç§°: {props.item.name}</p>
          <p>ä»·æ ¼: {props.item.price}</p>
          <p>æŠ˜æ‰£: {props.item.info}</p>
        </li>
      )
    }
    export default Son
    	
    `App.js`
    import { Component } from 'react'
    import Son from './Son.jsx'
    class App extends Component {
      state = {
        name: 'Appç»„ä»¶',
        list: [
          { id: 1, name: 'æ£’æ£’ç³–', price: 18.8, info: 'å…¨åœº8æŠ˜' },
          { id: 2, name: 'å¤§é¸¡è…¿', price: 34.2, info: 'å…¨åœº6æŠ˜' },
          { id: 3, name: 'å†°æ¿€å‡Œ', price: 14.2, info: 'å…¨åœº7æŠ˜' }
        ]
      }
      render () {
        return (
          <div className='parent'>
            æˆ‘æ˜¯Appç»„ä»¶
            <ul>
              {this.state.list.map(item => <Son key={item.id} item={item} />)}
            </ul>
          </div>
        )
      }
    }
    export default App
    ```
    
- å­ä¼ çˆ¶
    
    åˆ©ç”¨å›è°ƒå‡½æ•°ï¼Œçˆ¶ç»„ä»¶æä¾›å›è°ƒä¿®æ”¹çŠ¶æ€, å¹¶ä¸”å°†ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ä¼ ç»™å­ç»„å»ºï¼Œå­ç»„ä»¶è°ƒç”¨ï¼Œå°†è¦ä¼ é€’çš„æ•°æ®ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ã€‚
    
    ```jsx
    `App.jsx`
    import { Component } from 'react'
    import Son from './Son.jsx'
    class App extends Component {
      state = {
        name: 'Appç»„ä»¶',
        list: [
          { id: 1, name: 'æ£’æ£’ç³–', price: 18.8, info: 'å…¨åœº8æŠ˜' },
          { id: 2, name: 'å¤§é¸¡è…¿', price: 34.2, info: 'å…¨åœº6æŠ˜' },
          { id: 3, name: 'å†°æ¿€å‡Œ', price: 14.2, info: 'å…¨åœº7æŠ˜' }
        ]
      }
      cutPrice = (id, value) => {    // æä¾›å‡½æ•°ä¿®æ”¹è‡ªèº«çš„çŠ¶æ€
        this.setState({
          list: this.state.list.map(item => {
            if (item.id === id) {
              return {
                ...item,
                price: value
              }
            } else {
              return item
            }
          })
        })
      }
      render () {
        return (
          <div className='parent'>
            æˆ‘æ˜¯Appç»„ä»¶
            <ul>
              {this.state.list.map(item => <Son key={item.id} item={item} cutPrice={this.cutPrice} />)} // å°†å‡½æ•°ä¼ ç»™å­ç»„ä»¶,è®©å­ç»„ä»¶è°ƒç”¨
            </ul>
          </div>
        )
      }
    }
    export default App
    
    `Son.jsx`
    import { Component } from "react"
    // æ²¡æœ‰é€»è¾‘ å»ºè®®å‡½æ•°ç»„ä»¶
    class Son extends Component {
      render () {
        return (
          <li className='child' >
            <p>åç§°: {this.props.item.name}</p>
            <p>ä»·æ ¼: {this.props.item.price}</p>
            <p>æŠ˜æ‰£: {this.props.item.info}</p>
            <button onClick={this.cutParentPrice.bind(this, this.props.item.id, this.props.item.price)}>ç ä»·</button> // è°ƒç”¨çˆ¶ç»„ä»¶ç»™çš„å‡½æ•°å»ä¿®æ”¹çˆ¶ç»„ä»¶æ•°æ®
          </li>
        )
      }
      cutParentPrice = (id, price) => {
        this.props.cutPrice(id, price - 1)
      }
    }
    export default Son
    ```
    
- å…„å¼Ÿç»„ä»¶é€šè®¯
    
    åˆ©ç”¨çŠ¶æ€æå‡ å°†å…±äº«çŠ¶æ€æå‡åˆ°æœ€è¿‘çš„å…¬å…±çˆ¶ç»„ä»¶ä¸­ï¼Œç”±å…¬å…±çˆ¶ç»„ä»¶ç®¡ç†è¿™ä¸ªçŠ¶æ€
    
    ```jsx
    App.jsx
    import { Component } from 'react'
    import Son from './Son.jsx'
    import Son1 from './Son1.jsx'
    class App extends Component {
      state = {
        num: 9999
      }
      render () {
        return (
          <div className='parent'>
            <div>æˆ‘æ˜¯Appç»„ä»¶</div>
            <Son num={this.state.num} changeNum={this.changeNum}></Son>
            <Son1 num={this.state.num} changeNum={this.changeNum}></Son1>
          </div>
        )
      }
      changeNum = (newValue) => {
        this.setState({
          num: newValue
        })
      }
    }
    export default App
    
    Son,jsx
    import { Component } from "react"
    // æ²¡æœ‰é€»è¾‘ å»ºè®®å‡½æ•°ç»„ä»¶
    class Son extends Component {
      render () {
        return (
          <div>
            Sonç»„ä»¶ ï¼š {this.props.num}
            <button onClick={this.add.bind(this)}>++</button>
          </div>
        )
      }
      add = () => {
        this.props.changeNum(this.props.num + 1)
      }
    }
    export default Son
    
    Son1.jsx
    import { Component } from "react"
    class Son1 extends Component {
      render () {
        return (
          <div>
            Son1ç»„ä»¶ ï¼š {this.props.num}
            <button onClick={this.cut.bind(this)}>--</button>
          </div>
        )
      }
      cut = () => {
        this.props.changeNum(this.props.num - 1)
      }
    }
    export default Son1
    ```
    
- è·¨çº§ç»„ä»¶é€šè®¯ `Context`
    
    ç±»ä¼¼äº vueçš„ private å’Œ inject ä½¿ç”¨çš„è¾ƒå°‘.äº†è§£å³å¯ é‡ç‚¹å­¦ä¹ Redux
    
    ä½¿ç”¨æ­¥éª¤
    
    1. å¯¼å…¥ `createContext` æ–¹æ³•
        
        ```jsx
        import { Component, createContext } from "react"
        const { Provider, Consumer } = createContext()
        ```
        
    2. ä½¿ç”¨ `Provider` åŒ…è£¹çˆ¶ç»„ä»¶, å¹¶é€šè¿‡ `value` å±æ€§æä¾›è¦å…±äº«çš„æ•°æ®
        
        ```jsx
        const Context = createContext()
        class App extends Component {
        	  state = {
        	    num: 9999
        	  }
        	  render () {
        	    return (
        	      <Context.Provider value={{ num: this.state.num }}>
        	        <div className='parent'>
        	          <div>æˆ‘æ˜¯Appç»„ä»¶</div>
        	          <Son></Son>
        	        </div>
        	      </Context.Provider>
        	    )
        	  }
        	}
        export { Context }
        export default App
        ```
        
    3. ä¸‹çº§ç»„ä»¶å¼•å…¥ä¸Šçº§ç»„ä»¶ä¸­åˆ›å»ºçš„Contextå¯¹è±¡, æä¾›å‡½æ•°, å‡½æ•°å…¥å‚ä¸ºä¸Šçº§ç»„ä»¶å…±äº«çš„valueå€¼
        
        ```jsx
        import { Context } from './App' 
        	// æ²¡æœ‰é€»è¾‘ å»ºè®®å‡½æ•°ç»„ä»¶
        	class Son extends Component {
        	  render () {
        	    return (
        	      <Context.Consumer>
        	        {
        	          (data) => <div>  // æ³¨æ„: è¿™é‡Œè¦æä¾›ä¸€ä¸ªå‡½æ•°æ¥è·å–å…±äº«çš„çŠ¶æ€
        	            Sonç»„ä»¶ ï¼š{data.num}
        	          </div>
        	        }
        	      </Context.Consumer>
        	    )
        	  }
        }
        ```
        

# ç»„ä»¶é€šè®¯: `prop-types` ç±»å‹æ ¡éªŒåº“çš„ä½¿ç”¨

- ä½¿ç”¨ `prop-types` åº“ æ¥å®Œæˆ `props` çš„æ•°æ®ç±»å‹æ ¡éªŒ
    1. å¯¼å…¥ `prop-types` åŒ…
        
        ```jsx
        import PropTypes from 'prop-types'
        ```
        
    2. ä½¿ç”¨ç»„ä»¶å.propTypes = {} æ¥ç»™ç»„ä»¶çš„propsæ·»åŠ æ ¡éªŒè§„åˆ™
        
        ```jsx
        function App (props) {
        	  return (
        	    <h1>Hi, {props.colors}</h1>
        	  )
        	}
        
        	App.propTypes = {
        	  colors: PropTypes.array
        	  // çº¦å®šcolorså±æ€§ä¸ºarrayç±»å‹
        	  // å¦‚æœç±»å‹ä¸å¯¹ï¼Œåˆ™æ§åˆ¶å°æŠ¥å‡ºé”™è¯¯ï¼Œä¾¿äºåˆ†æé”™è¯¯åŸå› 
        }
        ```
        
- `props` çš„æ ¡éªŒè§„åˆ™
    1. å¸¸è§ç±»å‹ï¼šarrayã€boolã€funcã€numberã€objectã€string
    2. Reactå…ƒç´ ç±»å‹ï¼šelement
    3. å¿…å¡«é¡¹ï¼šisRequired
    4. ç‰¹å®šç»“æ„çš„å¯¹è±¡ï¼šshape({})
    
    ```jsx
    import ReactDOM from 'react-dom'
    import PropTypes from 'prop-types'
    
    function App (props) {
      return (
        <h1 style={props.colors}>Hi,</h1>
      )
    }
    App.propTypes = {
      colors: PropTypes.shape({               // colorsæ˜¯å›ºå®šå½¢çŠ¶çš„å¯¹è±¡
        color: PropTypes.string,              // string
        fontSize: PropTypes.number.isRequired // å¿…é¡» ä¸” number é“¾å¼è°ƒç”¨
      })
    }
    ReactDOM.render(<App colors={{ color: 'red', fontSize: 60 }}></App>, document.getElementById('root'))
    ```
    
- `props` çš„é»˜è®¤å€¼
    
    ä½¿ç”¨ `defaultProps`
    
    ```jsx
    function App (props) {
      return (
        <h1 style={props.colors}>Hi,</h1>
      )
    }
    App.propTypes = {
      colors: PropTypes.shape({
        color: PropTypes.string,              // string
        fontSize: PropTypes.number.isRequired // å¿…é¡»num
      })
    }
    App.defaultProps = {
      colors: {
        color: 'blue',
        fontSize: 90
      }
    }
    ReactDOM.render(<App></App>, document.getElementById('root'))
    ```
    
- **ä½¿ç”¨classå…³é”®å­— `static` æ¥ç®€åŒ–å†™æ³•**
    
    ES6æä¾› `static` ä¿®é¥°ç¬¦, ä¿®é¥°çš„æ–¹æ³•ç§°ä¸ºé™æ€æ–¹æ³•, å®ƒä»¬ä¸éœ€è¦å®ä¾‹åŒ–, è€Œæ˜¯ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨
    
    ```jsx
    class App extends Component {
      render() {
        return <h1 style={this.props.colors}> Hi,</h1>
      }
      static propTypes = {
        colors: PropTypes.shape({
          color: PropTypes.string, // string
          fontSize: PropTypes.number.isRequired, // å¿…é¡»num
        }),
      }
      static defaultProps = {
        colors: {
          color: 'pink',
          fontSize: 12,
        },
      }
    }
    ```
    

# ç±»ç»„ä»¶: ç”Ÿå‘½å‘¨æœŸ

ç”Ÿå‘½å‘¨æœŸ: ç»„ä»¶åœ¨æŒ‚è½½åçš„ä¸åŒé˜¶æ®µ

åªæœ‰ `ç±»ç»„ä»¶` æ‰æœ‰ç”Ÿå‘½å‘¨æœŸ. å‡½æ•°ç»„ä»¶ä¸å­˜åœ¨ç”Ÿå‘½å‘¨æœŸ(å‡½æ•°ç»„ä»¶æ€§èƒ½æ¶ˆè€—å°)

- ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„ ä¸‰ä¸ªé˜¶æ®µ, äº”ä¸ªé’©å­å‡½æ•°
    1. æŒ‚è½½é˜¶æ®µ constructor render componentDidMount
    2. æ›´æ–°é˜¶æ®µ render componentDidUpdate
    3. å¸è½½é˜¶æ®µ componentWillUnmount
    
    ```jsx
    // å…¨éƒ¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°
    1. constructor() 
    // åˆ›å»ºä¹‹å åˆå§‹åŒ–props,state,ä½†æ­¤æ—¶ä¸èƒ½è°ƒç”¨ setState,ç”¨æ¥bind this
    2. static getDerivedStateFromProps() ä¸å¸¸ç”¨
    3. shouldComponentUpdate() 
    // æ›´æ–°ç»„ä»¶å—ï¼Ÿ è¿”å›å¸ƒå°”å€¼ return false é˜»æ­¢æ›´æ–°/ return true æ›´æ–°
    // shouldComponentUpdateæœ‰ä»€ä¹ˆç”¨?
    // ç­”: å®ƒå…è®¸æˆ‘ä»¬æ‰‹åŠ¨åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œç»„ä»¶æ›´æ–°ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯çµæ´»åœ°è®¾ç½®è¿”å›å€¼ï¼Œ
    //     ä»¥é¿å…ä¸å¿…è¦çš„æ›´æ–°, èŠ‚çœæ€§èƒ½
    render() æ¸²æŸ“äº† åˆ›å»ºè™šæ‹ŸDOM
    getSnapshotBeforeUpdate() ä¸å¸¸ç”¨
    componentDidMount() ç»„ä»¶å·²ç»æŒ‚è½½å
    componentDidUpdate() ç»„ä»¶å·²ç»æ›´æ–°å
    componentWillUnmount() ç»„ä»¶å°†è¦å¸è½½æ—¶
    static getDerivedStateFromError() ä¸å¸¸ç”¨
    componentDidCatch() ä¸å¸¸ç”¨
    ```
    
- æŒ‚è½½é˜¶æ®µ: `constructor` `render` `componentDidMount`
    1. `constructor`æ˜¯æœ€å…ˆæ‰§è¡Œ,ç”¨æ¥æä¾›åˆå§‹åŒ–æ•°æ®
    å‰é¢å·²ç»è¯´è¿‡, classç»„ä»¶çš„å®Œæ•´å†™æ³•, `state`åº”è¯¥åœ¨ `constructor`ä¸­æä¾›
    2. `render`ç”¨æ¥æ¸²æŸ“è™šæ‹ŸUI , ä¸èƒ½åœ¨renderä¸­æ›´æ–°çŠ¶æ€, ä¼šé€ æˆæ­»å¾ªç¯.
    3.  `componentDidMount` ç»„ä»¶å·²ç»æŒ‚è½½å®Œæˆ,DOMå·²æ¸²æŸ“, åœ¨è¿™é‡Œå¯ä»¥è·å–åˆ°DOMå…ƒç´ , ä¸€èˆ¬åœ¨è¿™é‡Œå‘é€ajaxè¯·æ±‚
- æ›´æ–°é˜¶æ®µ: `render` `componentDidUpdate`
    1. ä¼šå†æ¬¡è§¦å‘renderå‡½æ•°, è§¦å‘DOMçš„æ›´æ–°
        
        ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ `render`
        
        1. åˆå§‹åŒ–æ•°æ®, ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“
        2. çˆ¶ç»„ä»¶çš„propsæ•°æ®å‘ç”Ÿæ”¹å˜
        3. ç»„ä»¶è‡ªèº«çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜, è°ƒç”¨setStateæ—¶
        4. è°ƒç”¨ `forceUpdate`API è§¦å‘reactç»„ä»¶å¼ºåˆ¶æ›´æ–°
    2. `componentDidUpdate` æ¯æ¬¡DOMæ›´æ–°åæ“ä½œæœ€æ–°DOMæ—¶è°ƒç”¨,  æ³¨æ„ä¸èƒ½åœ¨è¿™é‡Œè°ƒç”¨ `setState` å’Œ`forceUpdate` é¿å…è§¦å‘æ­»å¾ªç¯
- é”€æ¯é˜¶æ®µ: `componentWillUnmount`
    
    å¸è½½DOM,é”€æ¯å…¨å±€èµ„æº: å®šæ—¶å™¨æˆ–è€…æŒ‚è½½windowä¸Šçš„ä¸€äº›äº‹ä»¶ç­‰
    
- å…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°
    
    `shouldComponentUpdate` : æ›´æ–°é˜¶æ®µæ‰§è¡Œ, ç”¨äºåˆ¤æ–­ç»„ä»¶æ˜¯å¦æ›´æ–° (æ€§èƒ½ä¼˜åŒ–ç¯‡)
    

# `**setState` çš„é¢å¤–è¯´æ˜**

- `setState` æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„é—®é¢˜
    
    é¦–å…ˆè¯´ç»“è®º: `setState` è™½ç„¶è¡¨ç°å‡ºå¼‚æ­¥çš„ç‰¹æ€§, ä½†æ˜¯ä»–æ˜¯åŒæ­¥çš„
    
- `setState` çš„å¼‚æ­¥ç‰¹æ€§: è°ƒç”¨ `setState` åç«‹å³æ‰“å°æˆ–è€…è·å– `state` å€¼, ä¸ºåŸæ¥çš„å€¼
    
    åœ¨è°ƒç”¨ `setState` çš„æ—¶å€™ reactä¼šæŠŠæ‰€æœ‰çš„`setState` æ”¾åˆ°è‡ªå·±çš„ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­, å¹¶ä¸æ˜¯jsçš„å¼‚æ­¥é˜Ÿåˆ—
    reactä¼šå°†æ‰€æœ‰çš„ `setState` åˆå¹¶åˆ°ä¸€ä¸ªsetStateä¸­å»è°ƒç”¨, è¿™æ˜¯reactè‡ªèº«çš„æ€§èƒ½æ”¹è¿›
    
    ```jsx
    import { Component } from 'react'
    import ReactDOM from 'react-dom'
    class App extends Component {
      state = {
        count: 0,
      }
      render() {
        return (
          <div>
            <h1>{this.state.count}</h1>
            <button onClick={this.addCount}>å¢åŠ count</button>
          </div>
        )
      }
      addCount = () => {
        this.setState({
          count: this.state.count + 1,
        })
        console.log(this.state.count) // ç‚¹å‡»åå€¼ä¸º 0
        console.log(document.querySelector('h1').innerText) // åŒæ ·ä¸º0
      }
    }
    ReactDOM.render(<App></App>, document.getElementById('root'))
    ```
    
- `setState` è¿›é˜¶: æä¾›å‡½æ•°å½¢å¼(å…¥å‚ä¸ºä¸Šä¸€æ¬¡ `state` çš„å€¼), è¯æ˜å¼‚æ­¥ç‰¹æ€§
    
    ```jsx
    import { Component } from 'react'
    import ReactDOM from 'react-dom'
    class App extends Component {
      state = {
        count: 0,
      }
      render() {
        return (
          <div>
            <h1>{this.state.count}</h1>
            <button onClick={this.addCount}>å¢åŠ count</button>
          </div>
        )
      }
      addCount = () => {
    
        this.setState(pre => { // pre: 0
          return {
            count: pre.count + 1,
          }
        })
        this.setState(pre => { // pre: 1
          return {
            count: pre.count + 1,
          }
        })
    
        console.log(this.state.count) // ç‚¹å‡»åå€¼ä¸º 0
        console.log(document.querySelector('h1').innerText) // åŒæ ·ä¸º0
      }
    }
    ReactDOM.render(<App></App>, document.getElementById('root'))
    ```
    
- `**setState` çš„ç¬¬äºŒä¸ªå‚æ•°: å‡½æ•°, ä¼šç­‰å¾… `setState` æ‰§è¡Œåè°ƒç”¨**
    
    ```jsx
    import { Component } from 'react'
    import ReactDOM from 'react-dom'
    class App extends Component {
      state = {
        count: 0,
      }
      render() {
        return (
          <div>
            <h1>{this.state.count}</h1>
            <button onClick={this.addCount}>å¢åŠ count</button>
          </div>
        )
      }
      addCount = () => {
    	// setStateç¬¬ä¸€ä¸ªå‚æ•°ä¸º updaterå‡½æ•°, ç¬¬äºŒä¸ªä¸ºå›è°ƒå‡½æ•°
        this.setState(
          {
            count: this.state.count + 1,
          },
          () => {
            console.log('ä¼šç­‰å¾…updateræ‰§è¡Œåæ‰æ‰§è¡Œ') // setState æ‰§è¡Œåçš„å›è°ƒ
            console.log(this.state.count) // ç‚¹å‡»åå€¼ä¸º 1
            console.log(document.querySelector('h1').innerText) // åŒæ ·ä¸º 1
          },
        )
        console.log(this.state.count) // ç‚¹å‡»åå€¼ä¸º 0
      }
    }
    ReactDOM.render(<App></App>, document.getElementById('root'))
    ```
    
- æ€»ç»“ `setState` çš„ç‰¹ç‚¹
    - `setState`è™½ç„¶è¡¨ç°å‡ºçš„æ˜¯å¼‚æ­¥ç‰¹å¾,ä½†å®ƒå®é™…ä¸Šæ˜¯åŒæ­¥çš„.
    - reactæœ¬èº«æœ‰ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–æœºåˆ¶,è°ƒç”¨ `setState` æ—¶,reactä¸ä¼šç«‹åˆ»å»æ›´æ–°æ•°æ®(å¦‚æœç«‹åˆ»æ›´æ–°,ç»„ä»¶ä¼šç«‹åˆ»æ›´æ–°,æµªè´¹æ€§èƒ½),å®ƒä¼šæŠŠåŒä¸€ä¸ªå‘¨æœŸå†…æˆ–è€…åŒä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°å†…çš„æ‰€æœ‰ `setState` åˆå¹¶æˆä¸€ä¸ªä¹‹ååœ¨å»¶è¿Ÿè°ƒç”¨
    - å¦‚æœæˆ‘ä»¬åœ¨ `setTimeout/setInterval` æˆ–è€…åŸç”Ÿçš„äº‹ä»¶ä¸­/ç”šè‡³æ˜¯ `async,await` ä¸‹è°ƒç”¨ `setState`,å®ƒè¡¨ç°å‡ºæ¥æ˜¯åŒæ­¥çš„, å› ä¸ºreactå¤„ç†ä¸äº†è¿™ç±»æƒ…å†µ, ä¸Šä¸‹æ–‡ç¼ºå¤±. react18ä¸­ä¼˜åŒ–æ‰äº†(è¡¨ç°ä¸€è‡´)
    - `setState` çš„å¼‚æ­¥ç‰¹å¾å’Œ `JavaScript`çš„å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡æ²¡æœ‰ä»»ä½•å…³è”. å®ƒå°±æ˜¯ `react`è‡ªå·±çš„ä¸€ä¸ªå†…éƒ¨çš„æ€§èƒ½ä¼˜åŒ– , è¡¨ç°å‡ºå¼‚æ­¥ç‰¹å¾è€Œå·²
- [https://www.notion.so/React-9610e7e391874a7e9772e193899906f9#b6ae6a4c042140ef9930cecb31eb4199](https://www.notion.so/React-9610e7e391874a7e9772e193899906f9)

# å‡½æ•°ç»„ä»¶(React16.8ç‰ˆæœ¬): `Hooks` æ¥è¢­

- `hooks` å‡½æ•°ä¸¥æ ¼è§„å®š ä»¥ `use` å¼€å¤´
- `hooks` æ˜¯ä»€ä¹ˆ? ç»™å‡½æ•°ç»„ä»¶å¸¦æ¥äº†ä»€ä¹ˆ?
    - `hooks` ä¸ºå‡½æ•°ç»„ä»¶æä¾›çŠ¶æ€, ç”Ÿå‘½å‘¨æœŸå’ŒåŸæœ¬åœ¨ç±»ç»„ä»¶ä¸­æ‰èƒ½å®ç°çš„ React åŠŸèƒ½
    - åŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºé€šè¿‡ `hooks` ä¸ºå‡½æ•°ç»„ä»¶é’©å…¥äº†ç±»ç»„ä»¶çš„æ‰€æœ‰ç‰¹æ€§, ä»æ­¤ä»¥å, å‡½æ•°ç»„ä»¶ä¸å†æ˜¯æ— çŠ¶æ€ç»„ä»¶äº†. ç°åœ¨, å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶æœ‰åŒæ ·çš„èƒ½åŠ›
- `react` ä¸ºä»€ä¹ˆæ¨å‡ºäº† `hooks` ?
    1. åœ¨æ²¡æœ‰ `hooks` ä¹‹å‰, ä½¿ç”¨ç»„ä»¶æ—¶, éœ€è¦è€ƒè™‘ç±»ç»„ä»¶åˆé€‚è¿˜æ˜¯å‡½æ•°ç»„ä»¶åˆé€‚
    2. éœ€è¦ç†è§£ç±»ç»„ä»¶çš„ `this` 
    3. ç›¸åŒé€»è¾‘æ˜¯è¢«æ‹†åˆ†åˆ°ä¸åŒç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­çš„, ä¸åˆ©äºé€»è¾‘å¤ç”¨
    4. ç±»ç»„ä»¶ä¸åˆ©äºä»£ç å‹ç¼©å’Œä¼˜åŒ–(æ ‘æ‘‡), ä¸åˆ©äºtsç±»å‹æ¨æ–­(this)

# å‡½æ•°ç»„ä»¶: `hooks` çš„ä½¿ç”¨

- `hooks` ä½¿ç”¨æ³¨æ„äº‹é¡¹
    1. å¤šæ¬¡è°ƒç”¨ æä¾›çŠ¶æ€, é€»è¾‘å†™åˆ°ä¸€èµ·
    2. `hooks` å‡½æ•°åªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨, æ™®é€šå‡½æ•°ä¸å¯ä½¿ç”¨
    3. `hooks` å‡½æ•°ä¸èƒ½å†™åœ¨if/elseä¸­
    4. reactæ˜¯æŒ‰ç…§ `hooks` å‡½æ•°çš„è°ƒç”¨é¡ºåºæ¥è¯†åˆ«æ¯ä¸€ä¸ªhookçš„
- `useState`
    - `useState` ä¸ºå‡½æ•°ç»„ä»¶æä¾›çŠ¶æ€
        
        ä½¿ç”¨æ­¥éª¤: 
        
        1. ä»reactä¸­å€’å…¥è¦ä½¿ç”¨çš„ `hook`
            
            ```jsx
            import React, { useState } from 'react'
            ```
            
        2. åœ¨å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨(ä¹Ÿåªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨) , å¹¶ä¼ å…¥åˆå§‹å€¼
            
            ```jsx
            import { useState } from 'react'
            	export default function App() {
            	  const count = useState(0)
            	  console.log(count)
            		 // [0,f(){}]
            		 // countæ˜¯ä¸€ä¸ªæ•°ç»„, ç¬¬0é¡¹æ˜¯åˆå§‹çŠ¶æ€, ç¬¬ä¸€é¡¹æ˜¯ä¸€ä¸ªå‡½æ•°,ç”¨äºä¿®æ”¹çŠ¶æ€(æ–°å€¼æ›¿æ¢æ—§å€¼)
            	  return <div>123</div>
            }
            
            // ä¸€èˆ¬ä¼šä½¿ç”¨æ•°ç»„è§£æ„çš„æ–¹å¼æ¥ç®€åŒ–ä½¿ç”¨
            import { useState } from 'react'
            export default function App() {
              const [count, setCount] = useState(0)  // æ•°ç»„çš„ç»“æ„ 
              return (
                <div>
                  <div>{count}</div>
                  <button onClick={() => setCount(count + 1)}>ç‚¹å‡»</button>
                </div>
              )
            }
            
            //  å—æ§ç»„ä»¶
            import React, { useState } from 'react'
            export default function App () {
              const [value, setValue] = useState('') // '' ä¸ºåˆå§‹å€¼
              return (
                <div>
                  <input type="text" value={value} onChange={(e) => setValue(e.target.value)} />
                </div>
              )
            }
            ```
            
    - ä½¿ç”¨ `**useState`, ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ ( å‡½æ•°ç»„ä»¶æ²¡æœ‰æ‰€è°“çš„ç”Ÿå‘½å‘¨æœŸ )**
        1. å…ˆä»å¤´å¼€å§‹æ‰§è¡Œç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘( å¯ä»¥ç†è§£ä¸ºè°ƒç”¨ä¸€æ¬¡è¯¥å‡½æ•° )
        2. è°ƒç”¨ `useState()` å, å°†ä¼ å…¥çš„å€¼ä½œä¸ºåˆå§‹å€¼
        3. æ¸²æŸ“å½“å‰ç»„ä»¶, æ­¤æ—¶è·å–åˆ°åˆå§‹å€¼
        4. è°ƒç”¨ `useState()[1]` å‡½æ•°æ¥ä¿®æ”¹çŠ¶æ€å, å†æ¬¡è°ƒç”¨ `useState`, æ­¤æ—¶reactå†…éƒ¨ä¼šæ‹¿åˆ°æœ€æ–°çŠ¶æ€
        5. å‡½æ•°å†æ¬¡è°ƒç”¨, ç»„ä»¶å†æ¬¡æ¸²æŸ“(æ–°çŠ¶æ€)
        6. è¯æ˜: `useState` ä¸­å¯ä»¥æä¾›å‡½æ•°,å®ç°é€»è¾‘,æ¯”å¦‚åˆå§‹å€¼éœ€è¦è¡Œæœ¬åœ°è·å–çš„æƒ…å†µ
            
            ```jsx
            import React, { useState } from 'react'
            	function handleClick (value, setValue) {
            	  console.log(value)
            	  setValue(value + 1)
            	}
            	export default function App () {
            	  const [value, setValue] = useState(() => {
            	    console.log('è°ƒç”¨useState') // åªä¼šåœ¨åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡
            	    return 0
            	  })
            	  return (
            	    <div>
            	      <input type="text" value={value} onChange={(e) => setValue(e.target.value)} />
            	      <button onClick={() => handleClick(value, setValue)}>ç‚¹æˆ‘</button>
            	    </div>
            	  )
            }
            ```
            
    - `useState` ç”¨useState(å›è°ƒå‡½æ•°)å½¢å¼æä¾›åˆå§‹å€¼ useState(() => { return åˆå§‹å€¼ })
        1. å›è°ƒå‡½æ•°çš„è¿”å›å€¼å°±æ˜¯çŠ¶æ€çš„åˆå§‹å€¼
        2. è¯¥å›è°ƒå‡½æ•°åªä¼šè§¦å‘ä¸€æ¬¡, é€‚ç”¨äºéœ€è¦ä¸€æ®µé€»è¾‘æ¥è·å–åˆå§‹å€¼çš„æƒ…å†µ(æ¯”å¦‚æœ¬åœ°è·å–)
            
            ```jsx
            const [list, setList] = useState(() => {
              return JSON.parse(localStorage.getItem('comments')) || comments
            })
            ```
            
    
- `useEffect`
    
    ç”¨æ¥å¤„ç†å‡½æ•°ç»„ä»¶ä¸­çš„å‰¯ä½œç”¨:
    
    å¯¹äºreactç»„ä»¶æ¥è¯´ï¼Œé™¤äº†æ¸²æŸ“UIä¹‹å¤–çš„å…¶ä»–æ“ä½œï¼Œéƒ½å¯ä»¥ç§°ä¹‹ä¸ºå‰¯ä½œç”¨(æ“ä½œdom.ajaxç­‰)
    
    - `useEffect` çš„ä½¿ç”¨æ–¹æ³•: `useEffect` åœ¨ç»„ä»¶æ¸²æŸ“åå’Œç»„ä»¶æ›´æ–°åæ‰§è¡Œ
        
        ```jsx
        import { useEffct } from 'react'
        
        useEffect(() => {
        	console.log('useEffctæ‰§è¡Œäº†')
        })
        ```
        
    - `useEffect` ä¾èµ–é¡¹
        1. useEffctç¬¬äºŒå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„, å¯ä»¥æä¾›å›è°ƒå‡½æ•°è°ƒç”¨çš„ä¾èµ–å€¼, å¯ä»¥ä¾èµ–å¤šä¸ªå€¼
            
            ```jsx
            import React, { useEffect, useState } from 'react'
            function handleClick (value, setValue) {
              setValue(value + 1)
            }
            export default function App () {
              const [value, setValue] = useState(0)
              const [count, setCount] = useState(0)
              **useEffect(() => {
                document.title = value
              }, [value]) // åªæœ‰ä¾èµ–çš„valueçŠ¶æ€æ”¹å˜, å›è°ƒæ‰ä¼šæ‰§è¡Œ**
              return (
                <div>
                  <input type="text" value={value} onChange={(e) => setValue(e.target.value)} />
                  <button onClick={() => handleClick(value, setValue)}>ç‚¹æˆ‘</button>
                  <div>{count}</div>
                  <button onClick={() => setCount(count + 1)}>add</button>
                </div>
              )
            }
            ```
            
        2. å½“ä¾èµ–ä¸ºç©ºæ•°ç»„æ—¶, useEffctå›è°ƒåªåœ¨ç»„ä»¶åˆæ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡
            
            ```jsx
            // ä½¿ç”¨åœºåˆ
            // 1 äº‹ä»¶ç»‘å®š 
            // 2 å‘é€è¯·æ±‚è·å–æ•°æ® ç­‰
              useEffect(() => {
                window.onresize = function (e) {
                  console.log(window.innerWidth)
                }
              }, [])
            ```
            
        3. å½“ä¸å­˜åœ¨ä¾èµ–é¡¹æ—¶, æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½ä¼šè°ƒç”¨, ä¹Ÿå¯ä»¥è¯´ä¾èµ–æ‰€æœ‰çŠ¶æ€
        4. **ä¸è¦å¯¹ä¾èµ–é¡¹æ’’è°**
        å½“å›è°ƒå‡½æ•°ä¾èµ–åˆ°ä¸€äº›çŠ¶æ€æ—¶åŠ¡å¿…æä¾›è¯¥ä¾èµ–, å¦‚æœä¸æä¾›å¯¹åº”ä¾èµ–,å¯èƒ½ä¼šå¯¼è‡´çŠ¶æ€æ›´æ–°é”™è¯¯
    - `useEffect` è¿›é˜¶: æ¸…é™¤å‰¯ä½œç”¨
        
        ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨: ç»„ä»¶å¸è½½æ—¶æ¸…ç†äº‹ä»¶
        
        `useEffect` çš„è¿”å›å€¼æ˜¯å¯é€‰çš„ã€‚å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œç”¨æ¥æ‰§è¡Œäº‹ä»¶è§£ç»‘ç­‰æ¸…ç†æ“ä½œ
        
        ```jsx
        useEffect(() => {
            const handleResize = () => { }
            window.addEventListener('resize', handleResize)
            // è¿™ä¸ªè¿”å›çš„å‡½æ•°ï¼Œä¼šåœ¨è¯¥ç»„ä»¶å¸è½½æ—¶æ¥æ‰§è¡Œ
            // å› æ­¤ï¼Œå¯ä»¥å»æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œæ¯”å¦‚ï¼Œè§£ç»‘ window çš„å…¨å±€äº‹ä»¶ã€æ¸…ç†å®šæ—¶å™¨ç­‰
            return () => window.removeEventListener('resize', handleResize)
          })
        ```
        
        æ¸…ç†å‡½æ•°çš„æ‰§è¡Œæ—¶æœº:
        
        1. æ¸…ç†å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½æ—¶ä»¥åŠä¸‹ä¸€æ¬¡å‰¯ä½œç”¨å›è°ƒå‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‰§è¡Œï¼Œç”¨äºæ¸…é™¤ä¸Šä¸€æ¬¡çš„å‰¯ä½œç”¨ã€‚
        2. å¦‚æœä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„ï¼Œé‚£ä¹ˆä¼šåœ¨ç»„ä»¶å¸è½½æ—¶ä¼šæ‰§è¡Œã€‚ç›¸å½“äºç»„ä»¶çš„componetWillUnmount
            
            ```jsx
            useEffect(() => {
              window.onresize = () => {
                console.log(window.innerWidth)
              }
              return () => window.onresize = null
            }, [])
            ```
            
    - åœ¨ `useEffect` ä¸­å‘é€ `ajax` è¯·æ±‚
        
        **effect åªèƒ½æ˜¯ä¸€ä¸ªåŒæ­¥å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ async**
        
        1. å¦‚æœ effect æ˜¯ async çš„ï¼Œæ­¤æ—¶è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ã€‚è¿™æ ·çš„è¯ï¼Œ**å°±æ— æ³•ä¿è¯æ¸…ç†å‡½æ•°è¢«ç«‹å³è°ƒç”¨**
        2. **ä¸ºäº†ä½¿ç”¨ async/await è¯­æ³•ï¼Œå¯ä»¥åœ¨ effect å†…éƒ¨åˆ›å»º async å‡½æ•°ï¼Œå¹¶è°ƒç”¨**
            
            ```jsx
            useEffect(() => {
              async function fetchMyAPI() {
                let url = 'http://something/' + productId
                let config = {}
                const response = await myFetch(url)
              }
              fetchMyAPI()
            }, [productId])
            ```
            
- `useRef`
    - ä½¿ç”¨ `useRef` æ“ä½œDOM, æˆ–è€…æ“ä½œç±»ç»„ä»¶**(å‡½æ•°ç»„ä»¶ä¸èƒ½æ“ä½œ)**
        
        æ³¨æ„: è¦ä½¿ç”¨ `useRef` åˆ›å»ºçš„ `ref` å¯¹è±¡çš„ `current` å±æ€§
        
            åœ¨ç±»ç»„ä»¶ä¸­ `createRef` åˆ›å»º `ref` å¯¹è±¡
        
        ```jsx
        1. åˆ›å»ºrefå¯¹è±¡
        	import React, { Component, useRef, useEffect } from 'react'
        	const ref = useRef(null)
        	
        2. å°†refå…³è”åˆ°å¯¹åº”çš„domæˆ–è€…classç»„ä»¶ä¸Š
        	<Son ref={ref}></Son>
        
        3. é€šè¿‡refå¯¹è±¡çš„currentå±æ€§è®¿é—®åˆ°è¯¥dom
        	import React, { Component, useRef, useEffect } from 'react'
        	class Son extends Component {
        	  state = {
        	    count: 0
        	  }
        	  add = () => {
        	    console.log(1);
        	    this.setState({
        	      count: this.state.count + 1
        	    })
        	  }
        	  render () {
        	    return (
        	      <div>
        	        <div>{this.state.count}</div>
        	        <button onClick={this.add}>æŒ‰é’®</button>
        	      </div>
        	    )
        	  }
        	}
        	export default function App () {
        	  const ref = useRef(null)
        	  useEffect(() => {
        	    ref.current.add()
        	  }, [])
        	  return (
        	    <div>
        	      123
        	      <Son ref={ref}></Son>
        	    </div>
        	  )
        }
        ```
        
    - `useRef` çš„ç¬¬äºŒç§ç”¨æ³•: çªç ´é—­åŒ…å¸¦æ¥çš„é™åˆ¶
        
        `useRef` ä¼šè¿”å›ä¸€ä¸ªä¸å¯å˜çš„ `ref` å¯¹è±¡, è¯¥å¯¹è±¡çš„currentå±æ€§æ˜¯å¯å˜çš„
        
        è¿™ä¸ª `ref` å¯¹è±¡å¯ä»¥è´¯ä¸²å‡½æ•°ç»„ä»¶æ‰€æœ‰çš„å¿«ç…§, è€Œä¸” `ref` çš„ `current` å±æ€§æ”¹å˜, å‡½æ•°ç»„ä»¶ä¸ä¼šæ›´æ–°
        
        åœºæ™¯: å®šæ—¶å™¨ä¸­ä¿®æ”¹çŠ¶æ€
        
        ```jsx
        export default function useCountDown(time = 10, callback) {
          const [count, setCount] = useState(time)
          const timerRef = useRef(null)
        
          const start = () => {
            timerRef.current = setInterval(() => {
              console.log('å®šæ—¶å™¨å¼€å§‹')
              setCount(count => count - 1) // æä¾›å‡½æ•°æ¥è·å–ä¸Šä¸€ä¸ªå¿«ç…§è®¾ç½®çš„å€¼
            }, 1000)
          }
        
          useEffect(() => {
            if (count === 0) {
              callback && callback()
              console.log('æ¸…é™¤å®šæ—¶å™¨')
              clearInterval(timerRef.current)
              setCount(time)
            }
          }, [count])
        
          useEffect(() => {
            return () => {
              clearInterval(timerRef.current) // ç»„ä»¶å¸è½½æ—¶ï¼Œæ¸…é™¤å®šæ—¶å™¨
            }
          }, [])
          return { count, start }
        }
        
        const [time, setTime] = useState(5)
        const timeRef = useRef(time)
        useEffect(() => {
           let timerId = setInterval(() => {
             setTime(timeRef.current - 1)
             if (timeRef.current === 1) {
               clearInterval(timerId)
             }
           }, 1000)
           return () => {
             clearInterval(timerId)
          }
        }, [])
        
        useEffect(() => {
          timeRef.current = time
        }, [time])
        ```
        
    
    <aside>
    ğŸ’¡  æ³¨æ„: å¦‚æœ, refæ²¡æœ‰ç»‘å®šReactç»„ä»¶, å¹¶ä¸”åˆå§‹å€¼ä¸ºnull, é‚£ä¹ˆrefå¯¹è±¡å’Œå…¶currentå±æ€§ä¸å¯å˜(åªè¯»)
     è§£å†³: | null
    const refSocket = useRef<Socket | null>(null)
    
    </aside>
    
- `useContext`
    
    å›é¡¾ `Context` çš„è·¨ç»„ä»¶é€šè®¯çš„ç”¨æ³• : [https://www.notion.so/React-9610e7e391874a7e9772e193899906f9#e4f797a7251d4b85a4833ebc0bb59bc4](https://www.notion.so/React-9610e7e391874a7e9772e193899906f9)
    
    - `useContext` å’Œ `<Context.Consumer />`çš„åŒºåˆ«
    1. `useContext` åœ¨jsä»£ç ä¸­è·å– `Context`å…±äº«çŠ¶æ€.
    2. `<Context.Consumer />`åœ¨jsxä¸­è·å– `Context` çŠ¶æ€
        
        ```jsx
        import React, { Component, createContext, useContext } from 'react'
        const Context = createContext()
        function Son () {
          **const context = useContext(Context)  // ä¾ç„¶è¦é…åˆcreateContextä½¿ç”¨**
          console.log(context)
          return (
            <div>
              Sonç»„ä»¶ :{context.count}
            </div>
          )
        }
        
        class Father extends Component {
          render () {
            return (
              <div>
                Fatherç»„ä»¶:{123}
                <Son></Son>
              </div>
            )
          }
        }
        
        export default class App extends Component {
          state = {
            count: 100
          }
          render () {
            return (
              <Context.Provider value={{ count: this.state.count }}>
                <div>
                  Appç»„ä»¶ : {this.state.count}
                  <Father></Father>
                </div>
              </Context.Provider>
            )
          }
        }
        ```
        
- è‡ªå®šä¹‰ `Hooks`: å®ç°çŠ¶æ€çš„é€»è¾‘å¤ç”¨
    
    `Hooks` åªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­æˆ–å…¶ä»–è‡ªå®šä¹‰ `Hooks` ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼
    è‡ªå®šä¹‰ `Hooks` ç”¨æ¥æå–ç»„ä»¶çš„çŠ¶æ€é€»è¾‘ï¼Œæ ¹æ®ä¸åŒåŠŸèƒ½å¯ä»¥æœ‰ä¸åŒçš„å‚æ•°å’Œè¿”å›å€¼ï¼ˆå°±åƒä½¿ç”¨æ™®é€šå‡½æ•°ä¸€æ ·ï¼‰
    
    å®šä¹‰ä¸€ä¸ªè·å–é¼ æ ‡ä½ç½®çš„hook
    
    ```jsx
    import React, { useState, useEffect } from 'react'
    export const useMousePosition = () => {
      const [position, setPosition] = useState({
        x: 0,
        y: 0
      })
      useEffect(() => {
        const getPosition = (e) => {
          setPosition({
            x: e.pageX,
            y: e.pageY
          })
        }
        document.addEventListener('mousemove', getPosition)
        return () => document.removeEventListener('mousemove', getPosition)
      }, [])
      return position
    }
    
    App.js
    import React, { useState, useEffect } from 'react'
    import { useMousePosition } from './hooks'
    export default function App () {
      const position = useMousePosition()
      return (
        <div>
          x:{position.x}
          y:{position.y}
        </div>
      )
    }
    ```
    
- `Hooks` å‡½æ•°çš„ç‰¹æ€§
    1. æ¯æ¬¡çŠ¶æ€æ›´æ–°ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“
    2. æ¯æ¬¡ç»„ä»¶æ›´æ–°å°±åƒæ˜¯åœ¨ç»™ç»„ä»¶æ‹ç…§,æ¯æ¬¡æ›´æ–°å°±æ˜¯ä¸€å¼ ç…§ç‰‡,è®°å½•äº†ç»„ä»¶åœ¨ç‰¹å®šæ—¶åˆ»çš„çŠ¶æ€
    3. ç»„ä»¶æ¯æ¬¡æ›´æ–°éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„state/props/äº‹ä»¶å¤„ç†ç¨‹åºç­‰
    4. æ¯æ¬¡æ‹ç…§çš„ç…§ç‰‡åœ¨ä»£ç å±‚é¢æ¥è®²éƒ½æ˜¯é€šè¿‡å‡½æ•°çš„é—­åŒ…æœºåˆ¶å®ç°çš„
- `Hooks` å‡½æ•°ç‰¹æ€§å¸¦æ¥çš„é—®é¢˜ â‡’ reactè¿›é˜¶ â‡’ æ€§èƒ½ä¼˜åŒ– â‡’ å‡½æ•°ç»„ä»¶
    1. æ¯æ¬¡æ›´æ–°ç»„ä»¶å†…å¤„ç†ç¨‹åºè·å–åˆ°çš„æ˜¯ç‰¹å®šæ—¶åˆ»çš„çŠ¶æ€,å¦‚æœæ˜¯ä¸€ä¸ªå®šæ—¶å™¨ä¿®æ”¹äº†çŠ¶æ€,é‚£ä¹ˆæˆ‘ä»¬æ‹¿åˆ°çš„ä¸æ˜¯æœ€æ–°çš„çŠ¶æ€,è€Œæ˜¯é‚£æ¬¡ç‰¹å®šæ—¶åˆ»æ¸²æŸ“çš„çŠ¶æ€,è™½ç„¶å®¢è§‚è§’åº¦æ¥è¯´è¿™æ˜¯åˆç†çš„(é—­åŒ…æœºåˆ¶çš„å­˜åœ¨), ä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬æƒ³æ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€,ä¹Ÿå°±æ˜¯å®šæ—¶å™¨ä¿®æ”¹åçš„çŠ¶æ€,é‚£ä¹ˆæˆ‘ä»¬å°±è¦ä½¿ç”¨ `useRef` æ¥è§£å†³
        
        è§£å†³: [https://www.notion.so/React-9610e7e391874a7e9772e193899906f9#4ccad9efcc9241f69af1f3a2e517e675](https://www.notion.so/React-9610e7e391874a7e9772e193899906f9)
        
    2. æ¯æ¬¡æ›´æ–°ç»„ä»¶å†…çš„äº‹ä»¶å¤„ç†ç¨‹åºç­‰å‡½æ•°éƒ½ä¼šé‡æ–°åˆ›å»º, é‚£ä¹ˆä¼šé€ æˆå­ç»„ä»¶æ¯æ¬¡éƒ½æ¥æ”¶åˆ°ä¸åŒçš„propså¯¼è‡´ä¸å¿…è¦çš„æ¸²æŸ“æ€§èƒ½æµªè´¹, è¿™æ—¶å¯ä»¥æ–½ç”¨React.memoé«˜é˜¶ç»„ä»¶å’ŒuseMemo/useCallbackè§£å†³(å¯¹äºclassç»„ä»¶,è¿™ä¸ªé—®é¢˜å°±å¯ä»¥é€šè¿‡PureComponentæˆ–è€…shouldComponentUpdateæ¥è§£å†³)
    
    åŸå› :
    
    çˆ¶ç»„ä»¶æ¯æ¬¡æ›´æ–°æ—¶,å¦‚æœå­ç»„ä»¶propsæ²¡æœ‰æ›´æ–°,é‚£ä¹ˆå°±æ²¡å¿…è¦è¿›è¡Œé‡æ–°æ¸²æŸ“,ä½†æ˜¯reactç»„ä»¶æ›´æ–°æœºåˆ¶æ˜¯çˆ¶ç»„ä»¶æ›´æ–°äº†å­ç»„ä»¶æ˜¯æ— æ¡ä»¶æ›´æ–°çš„,ä¸ç®¡å­ç»„ä»¶æœ‰æ²¡æœ‰å˜åŒ–,æ‰€ä»¥æˆ‘ä»¬è¦é¿å…è¿™ä¸ªæ²¡å¿…è¦çš„æ›´æ–°é€ æˆæ€§èƒ½æµªè´¹
    
    è§£å†³:
    
    ä½¿ç”¨React.memoåŒ…è£¹çš„ç»„ä»¶å°±å¯ä»¥è¢«ç¼“å­˜ä¸‹æ¥,å¦‚æœå­ç»„ä»¶propsæ²¡æœ‰æ›´æ–°åˆ™è¿˜æ˜¯ç”¨ä¹‹å‰çš„ç¼“å­˜ç»„ä»¶,memoåœ¨å¯¹æ¯”propsçš„å˜åŒ–æ—¶ä½¿ç”¨çš„æ˜¯æµ…å±‚å¯¹æ¯”,æ‰€ä»¥æƒ³è®©å…¶è¯†åˆ«å¼•ç”¨ç±»å‹çš„props,æˆ‘ä»¬æ›´æ–°çŠ¶æ€çš„æ—¶å€™è¦æ›´æ”¹propsçš„æ ˆå¼•ç”¨,è¿™ç‚¹å’ŒPureComponentå¯¹æ¯”propsçš„ç‰¹æ€§æ˜¯ç±»ä¼¼çš„
    
    ```jsx
    import React, { useState } from 'react';
    const Child = React.memo(() => {
      console.log('å­ç»„ä»¶æ›´æ–°äº†...')
      return <div>æˆ‘æ˜¯å­ç»„ä»¶</div>
    })
    const Father = () => {
      const [count, setCount] = useState(0)
      return <div>
        <h1>{count}</h1>
        <button onClick={() => setCount(count + 1)}>+1</button>
        <button onClick={() => setCount(count - 1)}>-1</button>
        <Child />
      </div>
    }
    export default Father
    ```
    
    ```jsx
    const Child = React.memo(() => {
      console.log('å­ç»„ä»¶æ›´æ–°äº†...')
      return <div>æˆ‘æ˜¯å­ç»„ä»¶</div>
    },(prevProps,nextProps) => { 
      // ä¼ å…¥çš„å‚æ•°å°±æ˜¯å˜åŒ–å‰çš„propså’Œå˜åŒ–åçš„props,ç”¨æ¥ç»™æˆ‘ä»¬æ‰‹åŠ¨å¯¹æ¯”
      // return trueå°±æ˜¯ä¸æ›´æ–°,ä½¿ç”¨ç¼“å­˜ç»„ä»¶,return falseå°±æ˜¯æ›´æ–°
    })
    ```
    
    ä½¿ç”¨ `useCallback` åŒ…è£¹å‡½æ•°,é¿å…ç»„ä»¶æ›´æ–°é‡æ–°åˆ›å»ºå‡½æ•°é€ æˆæ€§èƒ½æµªè´¹
    
    ```jsx
    import React, { useCallback, useState } from 'react';
    const Child = React.memo(() => {
      console.log('å­ç»„ä»¶æ›´æ–°äº†...')
      return <div>æˆ‘æ˜¯å­ç»„ä»¶</div>
    })
    const Father = () => {
      let [count, setCount] = useState(0)
      // useCallbackç¬¬äºŒä¸ªå‚æ•°å’ŒuseEffectçš„å·®ä¸å¤š,ä¹Ÿæ˜¯å†³å®šæ˜¯å¦è§¦å‘çš„ä¾èµ–é¡¹,å¡«ç©ºæ•°ç»„å°±ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œä¸€æ¬¡
      const callback = useCallback(()=>{
        console.log('æŒ‰é’®ç‚¹å‡»äº†',count)
      },[count])
      return <div>
        <h1>{count}</h1>
        <button onClick={callback}>ç‚¹æˆ‘</button>
        <button onClick={() => setCount(count + 1)}>+1</button>
        <button onClick={() => setCount(count - 1)}>-1</button>
        <Child />
      </div>
    }
    export default Father;
    ```
    
    ä½¿ç”¨useCallbackåå°±å¯ä»¥ç¼“å­˜å‡½æ•°äº†,æŒ‡å®šä¾èµ–è®©ç»„ä»¶æ›´æ–°æ—¶åªåœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°åˆ›å»ºå‡½æ•°çš„å®ä¾‹
    
    ä½¿ç”¨ç©º[æ•°ç»„](https://so.csdn.net/so/search?q=%E6%95%B0%E7%BB%84&spm=1001.2101.3001.7020)çš„ç»“æœå°±æ˜¯ä¸ç®¡countæ€ä¹ˆå˜åŒ–è¾“å‡ºçš„éƒ½æ˜¯0,å› ä¸ºé—­åŒ…å‡½æ•°æ²¡æœ‰é‡æ–°åˆ›å»ºè¿‡,é‡Œé¢çš„countä»ç„¶ä¿ç•™çš„æ˜¯ä¹‹å‰çš„countå¼•ç”¨
    
    æŒ‡å®šä¾èµ–é¡¹ä¸ºcountçš„æ—¶å€™,åªæœ‰å½“countæ›´æ–°æ—¶æ‰ä¼šé‡æ–°åˆ›å»º,æ‰èƒ½æ‹¿åˆ°æœ€æ–°çš„countå€¼,æ‰€ä»¥æ­¤æ—¶è¾“å‡ºçš„countæ‰æ˜¯æœŸæœ›çš„å€¼
    
    tips:ä¸€èˆ¬åšç¼“å­˜ä¼˜åŒ–æ—¶éƒ½ä¼šå°†React.memoå’ŒuseCallbackæˆå¯¹ä½¿ç”¨æ¥æé«˜æ€§èƒ½
    
    useMemo:
    
    useMemoç”¨äºç¼“å­˜è®¡ç®—ç»“æœ,ä»–å’ŒuseCallbackä¸åŒä¹‹å¤„å°±æ˜¯useMemoç”¨äºç¼“å­˜è®¡ç®—ç»“æœ,ä»–è¿”å›çš„æ˜¯ä¸€ä¸ªè®¡ç®—ç»“æœçš„å€¼,è€ŒuseCallbackç”¨äºç¼“å­˜å‡½æ•°,æ‰€ä»¥å¯ä»¥æŠŠuseMemoç†è§£æˆVueä¸­çš„è®¡ç®—å±æ€§computed,åªæœ‰ä¾èµ–é¡¹å˜åŒ–äº†æ‰ä¼šæ›´æ–°ç¼“å­˜ç»“æœ,æé«˜æ•ˆç‡,ç”¨æ³•å’ŒuseEffectå·®ä¸å¤š.
    
    ```jsx
    import React, { useCallback, useMemo, useState } from 'react';
    const Child = React.memo(() => {
      console.log('å­ç»„ä»¶æ›´æ–°äº†...')
      return <div>æˆ‘æ˜¯å­ç»„ä»¶</div>
    })
    const Father = () => {
      let [count, setCount] = useState(0)
      const callback = useCallback(() => {
        console.log('æŒ‰é’®ç‚¹å‡»äº†', count)
      }, [count])
      // ä½¿ç”¨useMemoè®¡ç®—ä¸€ä¸ªå€¼è¿”å›
      const name = useMemo(() => {
        return `Suk-${count}`
      }, [count])
      return <div>
        <h1>{count}</h1>
        <button onClick={callback}>ç‚¹æˆ‘</button>
        <h3>åå­—:{name}</h3>
        <button onClick={() => setCount(count + 1)}>+1</button>
        <button onClick={() => setCount(count - 1)}>-1</button>
        <Child />
      </div>
    }
    export default Father;
    ```
    

# reactè¿›é˜¶

### å®ç°é€»è¾‘å¤ç”¨

- `mixins(æ··å…¥)` é€»è¾‘å¤ç”¨(å·²åºŸå¼ƒ:äº†è§£)
    
    `mixins` çš„ç¼ºç‚¹:
    
    1. å‘½åå†²çª
    2. æ¥æºä¸æ¸…æ™°
    3. `minins` ç›¸äº’ä¾èµ–, éš¾ä»¥ç»´æŠ¤
    4. é€æ¸å¢åŠ ä»£ç å¤æ‚æ€§
- `render props` å®ç°é€»è¾‘å¤ç”¨
    
    **æŒ‡ä¸€ç§åœ¨Reactç»„ä»¶ä¹‹é—´ä½¿ç”¨å€¼ä¸ºå‡½æ•°çš„propå…±äº«ä»£ç çš„æŠ€æœ¯.**
    
    render props æ˜¯ä¸€ç§é€»è¾‘å¤ç”¨çš„æ¨¡å¼, ä¼ é€’ä¸€ä¸ªå‡½æ•°ç±»å‹çš„propsæ¥å†³å®šè¦æ¸²æŸ“çš„å†…å®¹(ä¸€èˆ¬ä¼šå‘½åä¸ºrenderæˆ–è€…children)
    
    - å°çŸ¥è¯†: reactä¸­ `JSX.Element` `React.ReactElement` `React.ReactNode` åŒºåˆ«
        
        `ReactNode` :
        
        å¯ä»¥æ˜¯ä¸€ä¸ªReactElementï¼Œä¸€ä¸ªReactFragmentï¼Œä¸€ä¸ªstringç±»å‹ï¼Œä¸€ä¸ªnumberç±»å‹ï¼Œæˆ–è€…æ˜¯nullï¼Œæˆ–è€…æ˜¯booleanï¼Œæˆ–è€…æ˜¯undefinedï¼Œæˆ–è€…ä¸€ä¸ªReactNodeçš„æ•°ç»„
        
        `ReactElement` :
        
        ReactElementæ˜¯å…·æœ‰ç±»å‹å’Œå±æ€§çš„å¯¹è±¡ã€‚å¯ä»¥ç†è§£ä¸ºReact.createElementç”Ÿæˆçš„å¯¹è±¡ç±»å‹
        
        `JSX.Element`
        
        JSX.Elementæ˜¯ä¸€ä¸ªReactElementï¼Œé“å…·çš„æ³›å‹ç±»å‹æ˜¯ä»»æ„ç±»å‹ã€‚å®ƒå­˜åœ¨ï¼Œå› ä¸ºå„ç§åº“éƒ½å¯ä»¥ä»¥è‡ªå·±çš„æ–¹å¼å®ç°JSXï¼Œå› æ­¤JSXæ˜¯ä¸€ä¸ªå…¨å±€å‘½åç©ºé—´ï¼Œç„¶åç”±è¯¥åº“è®¾ç½®ï¼ŒReactå¯¹å…¶è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼š
        
        ```tsx
        declare global {
          namespace JSX {
            interface Element extends React.ReactElement<any, any> { }
          }
        }
        ```
        
    - render props ä½¿ç”¨è¿‡ç¨‹
        1. æä¾›ä¸€ä¸ªå…·æœ‰é€»è¾‘çš„ç»„ä»¶, è¯¥ç»„ä»¶æ¥æ”¶ä¸€ä¸ªè¿”å›ç»“æ„çš„å‡½æ•°, å¹¶ä¸”åœ¨è¯¥ç»„ä»¶æœ¬èº«çš„ `render`
            
            ä¸­è¿”å›è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨, 
            
            ```tsx
            import React, { Component } from 'react'
            
            // render props
            // jsxçš„ç±»å‹æ˜¯
            // type Props = {
            //   render: (state: State) => React.ReactElement
            // }
            type Props = {
              render: (state: State) => JSX.Element // jsx
              children?: React.ReactNode
            }
            
            type State = {
              x: number
              y: number
            }
            export default class MouseCom extends Component<Props, State> {
              state = {
                x: 0,
                y: 0,
              }
            
              handleMouseMove = (e: MouseEvent) => {
                console.log(e.pageX, e.pageY)
                this.setState({
                  x: e.pageX,
                  y: e.pageY,
                })
              }
              componentDidMount() {
                document.addEventListener('mousemove', this.handleMouseMove)
              }
              // ç»„ä»¶å¸è½½
              componentWillUnmount() {
                document.removeEventListener('mousemove', this.handleMouseMove)
              }
              render() {
                return this.props.render(this.state)
              }
            }
            ```
            
        2. ä½¿ç”¨è¯¥ç»„ä»¶çš„æ—¶å€™, æä¾› renderå‡½æ•°å’Œæ‰€éœ€çš„å…¥å‚, æ¥å®ç°å¤ç”¨è¯¥ç»„ä»¶çš„é€»è¾‘
            
            ```tsx
            import React, { Component } from 'react'
            import MouseCom from './components/MouseCom'
            import Image from './components/Image'
            import Position from './components/Position'
            
            export default class Not extends Component {
              render() {
                return (
                  <div>
                    <MouseCom render={(state) => <Image {...state}></Image>}></MouseCom>
                    <MouseCom render={(state) => <Position {...state}></Position>}></MouseCom>
                  </div>
                )
              }
            }
            ```
            
    - render props çš„ç¼ºç‚¹
        
        å¦‚æœé€»è¾‘éœ€è¦åµŒå¥—å¤ç”¨ä¼šå¯¼è‡´åµŒå¥—éªŒè¯, ä¸å¥½ç†è§£
        
- `é«˜é˜¶ç»„ä»¶ HOC` å®ç°é€»è¾‘å¤ç”¨(HOCæ˜¯reactä¸­ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„ä¸€ç§é«˜çº§æŠ€å·§):
    
    åŒ…è£…æ¨¡å¼: é€šè¿‡åŒ…è£…æ¨¡å¼ æ¥å¢å¼ºç»„ä»¶çš„èƒ½åŠ›
    
    é«˜é˜¶ç»„ä»¶: **æ˜¯ä¸€ä¸ªå‡½æ•°(**é€šå¸¸ä»¥ withå¼€å¤´**)**, æ¥å—ä¸€ä¸ªç»„ä»¶, è¿”å›ä¸€ä¸ªå¢å¼ºåçš„æ–°ç»„ä»¶
    
    é«˜é˜¶ç»„ä»¶å‘½å: `withMouse`  `withRouter` 
    
    - é«˜é˜¶ç»„ä»¶çš„ä½¿ç”¨:  æ³¨æ„æŠŠé«˜é˜¶ç»„ä»¶ä¸­çš„propsä¼ é€’ç»™ä¼ å…¥çš„ç»„ä»¶
        1. åˆ›å»ºä¸€ä¸ªåŒ…è£…å‡½æ•°, å‡½æ•°ä¸­è¿”å›ä¸€ä¸ª react ç±»ç»„ä»¶, è¯¥ç±»ç»„ä»¶æä¾›é€»è¾‘, ä½†æ˜¯ `render` çš„å†…å®¹åˆ™é€šè¿‡åŒ…è£…å‡½æ•°ä¼ å…¥ 
            
            ```tsx
            import React from 'react'
            
            export default function withMouse(Com: any) {
              // å†…éƒ¨å®šä¹‰ä¸€ä¸ªç±»ç»„ä»¶
              class Mouse extends React.Component {
                state = {
                  x: 0,
                  y: 0,
                }
                handleMouseMove = (e: MouseEvent) => {
                  console.log(e.pageX, e.pageY)
                  this.setState({
                    x: e.pageX,
                    y: e.pageY,
                  })
                }
                componentDidMount() {
                  document.addEventListener('mousemove', this.handleMouseMove)
                }
                // ç»„ä»¶å¸è½½
                componentWillUnmount() {
                  document.removeEventListener('mousemove', this.handleMouseMove)
                }
                render() {
                  return <Com {...this.state} {...this.props}></Com>
                }
              }
              return Mouse
            }
            
            `ç»„ä»¶`
            import React from 'react'
            
            type Props = {
              x: number
              y: number
              left?: number
              top?: number
            }
            export default function Position({ x, y, top = 0, left = 0 }: Props) {
              return (
                <div>
                  Positionç»„ä»¶
                  <div>x: {x}</div>
                  <div>y: {y}</div>
                  <div>top: {top}</div>
                  <div>left: {left}</div>
                </div>
              )
            }
            ```
            
        2. ä½¿ç”¨æ—¶, å°†éœ€è¦åŒ…è£…å¢å¼ºçš„ç»„ä»¶ä¼ å…¥è¯¥å‡½æ•°ä¸­, å¯å¾—åˆ°ä¸€ä¸ªåŒ…è£…åçš„ç»„ä»¶
            
            ```tsx
            import HPosition from './hoc/Position'
            import withMouse from './hoc/withMouse'
            const PositionWith = withMouse(HPosition)
            
            export default class Not extends Component {
              render() {
                return (
                  <div>
                    {/* HOC */}
                    <PositionWith></PositionWith>
                    <hr />
                  </div>
                )
              }
            }
            ```
            
    - é«˜é˜¶ç»„ä»¶çš„ç¼ºç‚¹:
        1. ç»„ä»¶çš„ç»“æ„å˜ä¹±, å˜å¾—éš¾ç»´æŠ¤
        2. ä½¿ç”¨ç¹ç
- `hooks` å®ç°é€»è¾‘å¤ç”¨:
    
    `hooks` è§£å†³çš„é—®é¢˜: 
    
    ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€å’Œé€»è¾‘å¤ç”¨å¾ˆéº»çƒ¦,ç»„ä»¶çš„ç»“æ„æ€»ä¼šå˜çš„éš¾ä»¥ç»´æŠ¤,  è€Œ `hooks` è®©æˆ‘ä»¬åœ¨ç»„ä»¶ç»“æ„ä¸å˜çš„æƒ…å†µä¸‹å®ç°äº†ä»£ç é€»è¾‘å¤ç”¨. è€Œä¸”ä½¿ç”¨èµ·æ¥æ›´åŠ ç®€å•.
    
    `hooks` çš„å¥½å¤„:
    
    1. å¸¦æ¥æ›´å¥½çš„é€»è¾‘å¤ç”¨
    2. è§£å†³äº†ç±»ç»„ä»¶ä¸­å£°æ˜å‘¨æœŸå°†ä»£ç é€»è¾‘æ‹†åˆ†çš„é—®é¢˜
    3. è§£å†³ç±»ç»„ä»¶ä¸­ `this` éš¾ä»¥ç†è§£çš„é—®é¢˜ 

### æ€§èƒ½ä¼˜åŒ–

- ç»„ä»¶çš„æ›´æ–°æœºåˆ¶
    
    `setState` è°ƒç”¨, ä¿®æ”¹çŠ¶æ€, æ¸²æŸ“UI
    
    **æ¸²æŸ“UIè¿‡ç¨‹**: çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶, å…¶æ‰€æœ‰çš„å­ç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“, å³ä½¿æ˜¯å­ç»„å»ºçš„çŠ¶æ€æ²¡æœ‰æ”¹å˜(è™šæ‹Ÿ diffæ›´æ–°)
    
- æ€§èƒ½ä¼˜åŒ–åŸåˆ™: åŠŸèƒ½ç¬¬ä¸€, æ€§èƒ½ä¼˜åŒ–ç¬¬äºŒ
- **ç±»ç»„ä»¶æ€§èƒ½ä¼˜åŒ–æ–¹å¼**
    1. **å‡è½» `setState`** : 
        1. åªå­˜å‚¨å’Œæ¸²æŸ“ç›¸å…³çš„æ•°æ®. (æ¯”å¦‚ loading, listç­‰)
        2. å®šæ—¶å™¨idç­‰å’Œæ¸²æŸ“æ— å…³çš„æ•°æ®ä¸è¦æ”¾ç½®setStateä¸­, ç›´æ¥æŒ‚è½½åˆ° `this` ä¸Š
    2. `**shouldComponentUpdate` ç”Ÿå‘½å‘¨æœŸå‡½æ•°**: åœ¨ç»„ä»¶æ›´æ–°å‰æ‰§è¡Œ, ç”¨äºåˆ¤æ–­æ˜¯å¦æ›´æ–°
        1. è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼, é»˜è®¤å€¼ä¸º true, ç›´æ¥æ›´æ–°ç»„ä»¶, å¦‚æœè®¾ç½®å€¼ä¸ºfalse, åˆ™ä¸æ›´æ–°
        2. æœ‰ä¸¤ä¸ªå‚æ•°, `nextProps` å’Œ `nextState` , å¯é€šè¿‡å¯¹æ¯”å½“å‰ `props` å’Œ `state` æ¥å†³å®šè¦ä¸è¦æ›´æ–°ç»„ä»¶
            
            ```tsx
            shouldComponentUpdate(nextProps: any, nextState: any) {
              return nextState.x !== this.state.x || nextState.y !== this.state.y
            }
            ```
            
            > æ³¨æ„: `shouldComponentUpdate` æ˜¯æå°‘ä½¿ç”¨çš„é’©å­, å¯èƒ½ä¼šå¯¼è‡´æƒ³è¦çš„æ›´æ–°æ²¡æœ‰æ‰§è¡Œ, æœ€å¥½è®©reactè‡ªå·±åˆ¤æ–­è¦ä¸è¦è¿›è¡Œæ›´æ–°
            > 
    3. **çº¯ç»„ä»¶ `React.PureComponent`** 
        
        `PureComponent` ç»„ä»¶å’Œ `Component` ç»„ä»¶åŠŸèƒ½ç±»å‹, 
        
        `PureComponent` åœ¨å†…éƒ¨è‡ªå·±å®ç°äº† `shouldComponentUpdate`  é’©å­å‡½æ•°, è‡ªåŠ¨åˆ¤æ–­ props å’Œ state çš„å€¼æ˜¯å¦å˜åŒ–, æœ€åå†³å®šæ˜¯å¦é‡æ–°æ¸²æŸ“ç»„ä»¶
        
        **ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çº¯ç»„ä»¶?**
        
        ä¸è¦æ‰€æœ‰çš„ç»„ä»¶éƒ½ä½¿ç”¨çº¯ç»„ä»¶, åªæœ‰çœŸæ­£åœ¨éœ€è¦æ€§èƒ½ä¼˜åŒ–çš„æ—¶å€™ä½¿ç”¨. å› ä¸ºçº¯ç»„ä»¶æ˜¯éœ€è¦æ¶ˆè€—é¢å¤–æ€§èƒ½è¿›è¡Œå¯¹æ¯”çš„
        
        **çº¯ç»„ä»¶æ¯”è¾ƒ - å€¼ç±»å‹**
        
        çº¯ç»„ä»¶çš„å†…éƒ¨å¯¹æ¯”æ˜¯æµ…å±‚å¯¹æ¯”, å¯¹äºpropæˆ–è€…stateæ˜¯å€¼ç±»å‹æ¥è¯´, ç›´æ¥å¯¹æ¯”ä¸¤ä¸ªå€¼å³å¯, æ²¡æœ‰é—®é¢˜
        
        **çº¯ç»„ä»¶æ¯”è¾ƒ - å¼•ç”¨ç±»å‹**
        
        å¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´, æ¯”è¾ƒçš„æ˜¯å¼•ç”¨åœ°å€. (è¿™é‡Œä¹Ÿæ˜¯ä¸€ç›´è¯´åœ¨reactä¸­è°ƒç”¨ `setState` æ—¶, è¦ç”¨æ–°å€¼æ›¿æ¢åŸæœ‰çš„å€¼çš„åŸå› ) 
        
        ```jsx
        PureComponent ä¼šåœ¨ render ä¹‹å‰å¯¹æ¯”æ–° state å’Œæ—§ state çš„æ¯ä¸€ä¸ª keyï¼Œä»¥åŠæ–° props å’Œæ—§ props çš„æ¯ä¸€ä¸ª keyã€‚
        å¦‚æœæ‰€æœ‰ key çš„å€¼å…¨éƒ½ä¸€æ ·ï¼Œå°±ä¸ä¼š renderï¼›å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ª key çš„å€¼ä¸åŒï¼Œå°±ä¼š renderã€‚
        
        // åšæ€§èƒ½ä¼˜åŒ–
        class App extends React.PureComponent {    // åªéœ€æ”¹è¿™ä¸€è¡Œä¾¿æœ‰äº† ä¸Šé¢çš„åŠŸèƒ½
        ```
        
- **å‡½æ•°ç»„ä»¶æ€§èƒ½ä¼˜åŒ–æ–¹å¼**
    1. `React.memo` (é«˜é˜¶ç»„ä»¶, ä½œç”¨ç›¸å¯¹äºç±»ç»„ä»¶çš„ `React.PureComponent` æˆ–è€…`**shouldComponentUpdate**`) 
        
        **ä¾æ—§æ˜¯æµ…å±‚å¯¹æ¯”**
        
        ç»„ä»¶æ›´æ–°è¿‡ç¨‹: 
        
        å­ç»„ä»¶propså˜åŒ–: ç»„ä»¶ä»£ç æ‰§è¡Œ â‡’ JSX Diff(é…åˆè™šæ‹ŸDOM) â‡’ é‡æ–°æ¸²æŸ“
        
        å­ç»„ä»¶propsæ²¡æœ‰å˜åŒ–: ç»„ä»¶ä»£ç æ‰§è¡Œ â‡’ JSX è™šæ‹ŸDOMå¯¹æ¯” â‡’ ä¸é‡æ–°æ¸²æŸ“
        
        åœ¨å­ç»„ä»¶çš„propsæ²¡æœ‰å˜åŒ–æ—¶, å…¶å®æ˜¯ä¸éœ€è¦æ›´æ–°çš„, ä¹Ÿå°±æ˜¯ä¸å¿…è¦è¿›è¡Œ diffå¯¹æ¯”è™šæ‹ŸDOM, è¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨ `React.memo`
        
        ```tsx
        import React from 'react'
        
        function Son() {
          return <div>Som</div>
        }
        
        export default React.memo(Son)
        ```
        
    2. `useCallback`  å’Œ `useMemo`: è§£å†³ `React.memo` å¤±æ•ˆçš„é—®é¢˜
        
        `React.memo` çš„é—®é¢˜: è¢«å…¶åŒ…è£¹çš„ç»„ä»¶ä¼šè¢«ç¼“å­˜, ä½†æ˜¯æ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½ä¼šåˆ›å»ºæ–°çš„propsçš„å€¼(æ¯”å¦‚äº‹ä»¶å¤„ç†å‡½æ•°ç­‰) è¿™å°±å¯¼è‡´ `React.memo` åœ¨å¤„ç†å¯¹è±¡ç±»å‹çš„propsä¼šå¤±æ•ˆ. (æ¯æ¬¡propséƒ½æ˜¯æ–°çš„å¯¹è±¡, `React.memo` æ˜¯æµ…å±‚å¯¹æ¯”
        
        `useCallback` é…åˆ `React.memo` è§£å†³ memo å¤±æ•ˆé—®é¢˜
        
        `useCallback` é…åˆå…¶ä¾èµ–æ€§, ç”¨äºè®°å¿†æŸä¸ªå›è°ƒå‡½æ•°æ˜¯å¦å‘ç”Ÿå˜åŒ–, æœ€ç»ˆç”¨äºåˆ¤æ–­å­ç»„å»ºæ˜¯å¦æ›´æ–°
        
        ```tsx
        // f
        import React, { useCallback } from 'react'
        import Son from './Son'
        
        function F() {
          const [count, setCount] = React.useState(0)
          const add = useCallback(
            (num: number) => {
              setCount(count + num)
            },
            [count],
          )
          return (
            <div>
              <Son add={add}></Son>
            </div>
          )
        }
        
        export default React.memo(F)
        
        // Son
        import React from 'react'
        
        type Props = {
          add: (num: number) => void
        }
        
        function Son({ add }: Props) {
          return (
            <div>
              <button onClick={() => add(10)}> +10 </button>
            </div>
          )
        }
        
        export default React.memo(Son)
        
        ```
        
    3. `useMemo` : 
        
        ä½¿ç”¨å’Œ `useCallback` ä¸€æ ·, ç”¨äºç¼“å­˜å›è°ƒå‡½æ•°. 
        
        `useMemo` å¯ä»¥è®°å¿†ä»»æ„ç±»å‹çš„æ•°æ®, `useCallback` åªèƒ½è®°å¿†å‡½æ•°. å¦‚æœè®°å¿†å‡½æ•°, æ¨è `useCallback`
        
        `useMemo` æœ‰ç‚¹ç±»ä¼¼äºvueä¸­çš„è®¡ç®—å±æ€§.
        
        ```tsx
        import React, { useCallback, useMemo } from 'react'
        import Son from './Son'
        
        function F() {
          const [count, setCount] = React.useState(0)
          const add = useCallback(
            (num: number) => {
              setCount(count + num)
            },
            [count],
          )
          // è®°å¿†æ™®é€šæ•°æ®
          **const count2 = useMemo(() => {
            return count * 2
          }, [count])
        
          // è®°å¿†å‡½æ•°
          const add2 = useMemo(() => {
            return () => {
              console.log(count2)
            }
          }, [count2])**
          return (
            <div>
              <Son add={add}></Son>
            </div>
          )
        }
        
        export default React.memo(F)
        ```
        

### è™šæ‹ŸDOMå’ŒDIFFç®—æ³•

- ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOM? 1. æé«˜æ¸²æŸ“æ€§èƒ½ 2. è·¨å¹³å°
    1. é¦–å…ˆè™šæ‹ŸDOMå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ js å¯¹è±¡, ç»“æ„è¦æ¯”çœŸå®DOMç®€å•çš„å¤š, æ‰€ä»¥ç”Ÿæˆè™šæ‹ŸDOMæ¶ˆè€—åŠå°.
    2. reactä¼šæ ¹æ®JSXç»“æ„ç”Ÿæˆè™šæ‹ŸDOMæ ‘, åœ¨æ ¹æ®è™šæ‹ŸDOMæ ‘æ¸²æŸ“çœŸå®DOMæ ‘, 
    3. å½“æ•°æ®å‘ç”Ÿæ”¹å˜, reactä¼šç”Ÿæˆæ–°çš„è™šæ‹ŸDOMæ ‘, ç„¶åæ ¹æ®diffç®—æ³•å¯¹æ¯”å‰åä¸¤æ¬¡è™šæ‹ŸDOMæ ‘çš„ä¸åŒ, ç”±è™šæ‹ŸDOMæ ‘çš„ä¸åŒæ¥æ›´æ–°çœŸå®DOMæ ‘(æœ€å¤§é™åº¦çš„å‡å°‘DOMæ“ä½œ)
- `diff` ç®—æ³•
    
    ä¼ ç»Ÿçš„ `diffç®—æ³•` , å¤æ‚åº¦çš„ä¸º **n*3**, ä½†æ˜¯ reactä¸­ å®ç°çš„ `diff ç®—æ³•` å¤æ‚åº¦ä¸º **n** 
    
    react diff ç®—æ³•æ˜¯æ·±åº¦ä¼˜å…ˆè¿˜æ˜¯å¹¿åº¦ä¼˜å…ˆ ? æ·±åº¦ä¼˜å…ˆ
    
    reactä¸­ `diffç®—æ³•` çš„ç­–ç•¥:
    
    1. tree diff: åªå¯¹æ¯”åŒçº§, ä¸è·¨çº§è¿›è¡Œå¯¹æ¯” (å¦‚æœèŠ‚ç‚¹ç±»å‹å‘ç”Ÿæ”¹å˜, åˆ™ç›´æ¥é”€æ¯æ•´ä¸ªDOMå¹¶ä¸”é‡å»º, å¦‚æœèŠ‚ç‚¹ç±»å‹æ²¡æœ‰æ”¹å˜, é‚£ä¹ˆå¯¹æ¯”å…¶å±æ€§, å¹¶ä¸”å¯¹å˜åŒ–çš„å±æ€§è¿›è¡Œæ›´æ–°). ç„¶åå¯¹å­èŠ‚ç‚¹è¿›è¡Œé€’å½’éå†, åœ¨å­èŠ‚ç‚¹æœ«å°¾æ–°å¢èŠ‚ç‚¹æ—¶å¼€é”€è¾ƒå°, ä½†æ˜¯åœ¨å­èŠ‚ç‚¹å‰æ–°å¢èŠ‚ç‚¹æ—¶, å¼€é”€è¾ƒå¤§. å°±è¿™å¸¦æ¥æ€§èƒ½é—®é¢˜, è¿™å°±æ˜¯éœ€è¦å”¯ä¸€çš„ key æ¥è§£å†³çš„é—®é¢˜ 
    2. key:  å½“å…ƒç´ æºå¸¦ key å±æ€§æ—¶, èŠ‚ç‚¹å¯¹æ¯”æ—¶, ä¼šå°†ç›¸åŒ key çš„èŠ‚ç‚¹è¿›è¡Œå¯¹æ¯”, å¦‚æœæ²¡æœ‰ key åˆ™æŒ‰é¡ºåºå¯¹æ¯”, æœ€å, è¿›è¡Œå·®å¼‚åŒ–æ›´æ–°, æœ€å¤§é™åº¦çš„å‡å°‘æ¶ˆè€—. (key èµ·åˆ°å”¯ä¸€æ ‡è®°çš„ä½œç”¨, æ‰€ä»¥ key ä¸å¯é‡å¤)  
    
    **react diff çš„ ç¼ºç‚¹**
    

### Reactæ¶æ„

- **react15**: æä¾›çš„ `diff` ç®—æ³•å®¹æ˜“å‡ºç°ä¸¢å¸§çš„æƒ…å†µ
    
    **æµè§ˆå™¨çš„ä¸¢å¸§:** æµè§ˆå™¨æ¯ç§’åˆ·æ–°60æ¬¡, æ¯ä¸€å¸§æ‰€éœ€è¦çš„æ—¶é—´çº¦ä¸º `16.7ms`,  è€Œ  `GUIæ¸²æŸ“çº¿ç¨‹`å’Œ  `JS çº¿ç¨‹`æ˜¯äº’æ–¥çš„(jsæ‰§è¡Œå’Œæµè§ˆå™¨å¸ƒå±€ç»˜åˆ¶ä¸èƒ½åŒæ—¶è¿›è¡Œ), åœ¨åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œjsä»£ç æˆ–è€…æ¸²æŸ“domå…ƒç´ , å¦‚æœä¸»çº¿ç¨‹ä¸€ç›´è¢«jså ç”¨, é‚£ä¹ˆ**æ¸²æŸ“å¼•æ“**æ— æ³•åœ¨è§„å®šæ—¶é—´(æµè§ˆå™¨åˆ·æ–°é¢‘ç‡ **16.7**ms)å†…å®Œæˆå·¥ä½œï¼Œä½¿å¾—é¡µé¢å‡ºç°**å¡é¡¿(æ‰å¸§)**ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚
    
    **react15æ¶æ„:**   
    
    **åè°ƒå™¨ `Reconciler`** è´Ÿè´£è°ƒç”¨render ç”Ÿæˆè™šæ‹Ÿ DOM, è¿›è¡Œ Diff, æ‰¾å‡ºå˜åŒ–åçš„DOM
    
    **æ¸²æŸ“å™¨ `Renderer`** è´Ÿè´£æ¥æ”¶`Reconciler` é€šçŸ¥, å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åœ¨å½“å‰å®¿ä¸»ç¯å¢ƒ(react-dom/react-native)
    
    **react15æ¶æ„æ˜“å‡ºç°çš„ç¼ºé™·:**
    
    Reconciler è¿›è¡Œ diff æ—¶, å¦‚æœèŠ‚ç‚¹éå¸¸å¤š, å³ä½¿æ˜¯åªæœ‰ä¸€æ¬¡stateå˜æ›´, reactä¹Ÿéœ€è¦è¿›è¡Œå¤æ‚çš„é€’å½’æ›´æ–°(å ç”¨ä¸»çº¿ç¨‹), è€Œæ›´æ–°ä¸€æ—¦å¼€å§‹, **ä¸­é€”æ˜¯æ— æ³•ä¸­æ–­çš„**, ç›´åˆ°éå†å®Œ, **æ‰èƒ½é‡Šæ”¾ JS ä¸»çº¿ç¨‹. å¯¼è‡´é¡µé¢æ‰å¸§å¡é¡¿**
    
    **çŠ¶æ€æ›´æ–°:**
    
    - æ‰¹å¤„ç†: å¤šæ¬¡è°ƒç”¨ setState() ä¼šåˆå¹¶ä¸ºä¸€æ¬¡æ›´æ–°
    - åŸç†: è°ƒç”¨ setState ä¸ä¼šç«‹å³æ›´æ–°çŠ¶æ€, è€Œæ˜¯å­˜å‚¨åˆ° ä¸€ä¸ªreacté˜Ÿåˆ—ä¸­, å¯¼è‡´ åœ¨åŒæ­¥å¼‚æ­¥æ“ä½œæ—¶, setState è¡¨ç°ä¸ä¸€è‡´
    
    ![Untitled](React%20068a8677f1874d7d8beabb6002f19b86/Untitled.png)
    
- **react16**: æä¾› `Fiber` æ¶æ„é‡æ„ â‡’ `requestIdleCallback API` ä½†ç”±äºå…¼å®¹æ€§ä¸å¥½ï¼ŒåŠ ä¸Šè¯¥å›è°ƒå‡½æ•°è¢«è°ƒç”¨çš„é¢‘ç‡å¤ªä½ï¼Œreactå®é™…ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªpolyfill(è‡ªå·±å®ç°çš„api)ï¼Œè€Œä¸æ˜¯requestIdleCallbackã€‚
    
    `**Fiber` æ¶æ„:** 
    
    `Scheduler`: è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§, é«˜ä¼˜å…ˆçº§å…ˆè¿›å…¥ Reconciler
    
    `Reconciler`: æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶, (ä½¿ç”¨ `Fiber` é‡æ„)
    
    `Renderer`: è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š
    
    `**Fiber` æ ¸å¿ƒ**: ç»„ä»¶æ¸²æŸ“å¯ä¸­æ–­, ä¿è¯æµè§ˆå™¨ `GUI` æ¸²æŸ“ä¸ä¸¢å¸§
    
    **å¦‚ä½•å®ç°**: 
    
    - æ—¶é—´åˆ‡ç‰‡(å¤§ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡ â‡’ å—é™CPU) åŸºäºÂ **`MessageChannel` API** å®ç°çš„
        
        åœ¨æµè§ˆå™¨æ¯ä¸€å¸§çš„æ—¶é—´ä¸­é¢„ç•™ä¸€äº›æ—¶é—´ç»™JSçº¿ç¨‹, reactåˆ©ç”¨é¢„ç•™çš„è¿™éƒ¨åˆ†æ—¶é—´æ›´æ–°ç»„ä»¶(diff), å½“æ—¶é—´ä¸å¤Ÿç”¨æ—¶, reactå°†çº¿ç¨‹æ§åˆ¶æƒäº¤è¿˜ç»™æµè§ˆå™¨, è®©ä»–æœ‰æ—¶é—´æ¸²æŸ“UI, reactåˆ™ç­‰å¾…ä¸‹ä¸€å¸§åœ¨ç»§ç»­æ‰§è¡Œè¢«ä¸­æ–­çš„ä»»åŠ¡
        
        ```tsx
        æˆ‘ä»¬çŸ¥é“é€šè¿‡ setTimeoutï¼Œå¯ä»¥å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªå®ä»»åŠ¡ã€‚å½“è¯¥å®ä»»åŠ¡è¢«å¤„ç†æ—¶ï¼Œå¯¹åº”çš„ callback ä¼šè¢« js å¼•æ“å¤„ç†ã€‚
        åŸºäºæ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ eventLoop æ¥å®ç°æ—¶é—´åˆ†ç‰‡ä»¥åŠé‡æ–°è¯·æ±‚æ—¶é—´ç‰‡ã€‚
        ä¸€æ®µ js ç¨‹åºï¼Œå¦‚æœåœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰ç»“æŸï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä¸»åŠ¨ç»“æŸå®ƒï¼Œç„¶åé€šè¿‡ setTimeout è¯·æ±‚ä¸€ä¸ªæ–°çš„æ—¶é—´ç‰‡ï¼Œåœ¨ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡å†…ç»§ç»­å¤„ç†ä¸Šä¸€æ¬¡æ²¡æœ‰ç»“æŸçš„ä»»åŠ¡ã€‚
        
        // ä¼ªä»£ç 
        
        let taskQueue = [...];   // js ç¨‹åºè¦å¤„ç†çš„ä»»åŠ¡åˆ—è¡¨
        let shouldTimeEnd = 5ms;  // ä¸€ä¸ªæ—¶é—´ç‰‡å®šä¹‰ä¸º 5ms
        
        function processTaskQueue() {
            let beginTime = performance.now();  // è®°å½•å¼€å§‹æ—¶é—´
            while(true) { // å¾ªç¯å¤„ç† taskQueue ä¸­çš„ä»»åŠ¡
                let currentTime = performance.now(); // è®°å½•ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹æ—¶çš„æ—¶é—´
                if (currentTime - beginTime >= shouldTimeEnd) break; // æ—¶é—´ç‰‡åˆ°æœŸï¼Œç»“æŸä»»åŠ¡å¤„ç†
                processTask();  // æ²¡æœ‰åˆ°æœŸï¼Œç»§ç»­å¤„ç†ä»»åŠ¡
            }
            if (taskQueue.length) {  // æ—¶é—´åˆ°æœŸï¼Œé€šè¿‡ setTimeout è¯·æ±‚ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ç»§ç»­å¤„ç†ä»»åŠ¡
                setTimeout(processTaskQueue, 0); // åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡å†…ï¼Œç»§ç»­å¤„ç†ä»»åŠ¡
            }
        }
        
        processTaskQueue();
        
        ä½¿ç”¨ setTimemout ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°½ç®¡è®¾ç½®äº†å»¶æ—¶æ—¶é—´ä¸º 0msï¼Œä½†å®é™…ä¸Šä»ç„¶ä¼šæœ‰å¤§æ¦‚ 4ms å·¦å³çš„å»¶è¿Ÿï¼Œå¯¼è‡´ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ä¸èƒ½å°½å¿«æ‹¿åˆ°. å¯ä»¥ä½¿ç”¨ MessageChannel æ¥æ›¿æ¢ setTimeoutã€‚ä½¿ç”¨ MessageChannel æ—¶ï¼Œåªä¼šæœ‰å¤§æ¦‚ 1ms å·¦å³çš„å»¶è¿Ÿï¼Œå¯ä»¥å°½å¿«çš„æ‹¿åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ã€‚
        
        // ä¼ªä»£ç 
        
        let taskQueue = [...];   // ä»»åŠ¡åˆ—è¡¨
        let shouldTimeEnd = 5ms;   // ä¸€ä¸ªæ—¶é—´ç‰‡å®šä¹‰ä¸º 5ms
        let channel = new MessageChannel();  // åˆ›å»ºä¸€ä¸ª MessageChannel å®ä¾‹
        
        function processTaskQueue() {
            let beginTime = performance.now();  // è®°å½•å¼€å§‹æ—¶é—´
            while(true) { // å¾ªç¯å¤„ç† taskQueue ä¸­çš„ä»»åŠ¡
                let currentTime = performance.now();  // è®°å½•ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹æ—¶çš„æ—¶é—´
                if (currentTime - beginTime >= shouldTimeEnd) break;  // æ—¶é—´ç‰‡å·²ç»åˆ°æœŸï¼Œç»“æŸä»»åŠ¡å¤„ç†
                processTask();  // æ—¶é—´ç‰‡æ²¡æœ‰åˆ°æœŸï¼Œç»§ç»­å¤„ç†ä»»åŠ¡
            }
            if (taskQueue.length) { // æ—¶é—´ç‰‡åˆ°æœŸï¼Œé€šè¿‡è°ƒç”¨ postMessageï¼Œè¯·æ±‚ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡
                channel.port2.postMessage(null); 
            }
        }
        
        channel.port1.onmessage = processTaskQueue;  // åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡å†…ç»§ç»­å¤„ç†ä»»åŠ¡
        processTaskQueue();
        ```
        
    - ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦(ä¼˜å…ˆçº§åˆ’åˆ†)
        
        æµè§ˆå™¨æœ¬èº«çš„**ä»»åŠ¡è°ƒåº¦**æ˜¯æ²¡æœ‰**ä¼˜å…ˆçº§**æ¦‚å¿µçš„ï¼Œéµå¾ªçš„æ˜¯ **FIFO** ç­–ç•¥ï¼Œå³å…ˆè¿›å…¥**æ¶ˆæ¯é˜Ÿåˆ—**é‡Œé¢çš„ä»»åŠ¡å…ˆå¤„ç†ã€‚ä½†æ˜¯ç”¨æˆ·çš„**äº¤äº’æ“ä½œ**æ˜¯æœ‰**ä¼˜å…ˆçº§**çš„ï¼Œæ¯”å¦‚ä¸€æ¬¡ç‚¹å‡»æ“ä½œï¼Œç”¨æˆ·ä¼šæœŸæœ›èƒ½å¿«é€Ÿçœ‹åˆ°ç»“æœï¼Œä¼˜å…ˆçº§è¾ƒé«˜ï¼›åˆ‡æ¢é¡µé¢ï¼Œå¯ä»¥å»¶è¿Ÿä¸€äº›ï¼Œä¼˜å…ˆçº§ä¸é«˜ã€‚ä¸ºäº†å¯ä»¥æ ¹æ®**ä¼˜å…ˆçº§**è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œ**react** è‡ªèº«åœ¨æµè§ˆå™¨ **eventLoop** çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†ä¸€å¥—å¸¦**ä¼˜å…ˆçº§**çš„ä»»åŠ¡è°ƒåº¦ - **workLoop**ã€‚
        
- react17: è¿‡åº¦ç‰ˆæœ¬, ç”¨æ¥ç¨³å®š **`Concurrent Mode` ,** å¹¶ä¸”æä¾›æ–°çš„ä¼˜å…ˆçº§ç®—æ³•

### react18: **æ¸²æŸ“æ˜¯å¯ä¸­æ–­çš„**

> **`React 18`** å·²ç»æ”¾å¼ƒäº†å¯¹Â **`ie11`** çš„æ”¯æŒ
> 

`React 17` å’Œ `React 18` çš„åŒºåˆ«å°±æ˜¯ï¼šä»`åŒæ­¥ä¸å¯ä¸­æ–­æ›´æ–°`å˜æˆäº†`å¼‚æ­¥å¯ä¸­æ–­æ›´æ–°`ã€‚

æ–°ç‰¹æ€§: 

- æ–°çš„ `render API`
    
    ä¸ºäº†æ›´å¥½çš„ç®¡ç†**`rootèŠ‚ç‚¹`**ï¼Œ**`React 18`** å¼•å…¥äº†ä¸€ä¸ªæ–°çš„Â **`root API`**ï¼Œæ–°çš„Â **`root API`**  æ”¯æŒÂ **`new concurrent r`ender**ï¼ˆå¹¶å‘æ¨¡å¼çš„æ¸²æŸ“ï¼‰ï¼Œå®ƒå…è®¸ä½ è¿›å…¥**`concurrent mode`**ï¼ˆå¹¶å‘æ¨¡å¼ï¼‰ã€‚
    
    å¦‚æœä½ åšæŒåœ¨react18ä¸­ä½¿ç”¨react17çš„render API ä¹Ÿå¯ä»¥, react18å…¼å®¹æ—§çš„render API (å¿½ç•¥è­¦å‘Šå³å¯)
    
    ```tsx
    // React 17
    import React from 'react';
    import ReactDOM from 'react-dom';
    import App from './App';
    
    const root = document.getElementById('root')!;
    
    ReactDOM.render(<App />, root);
    
    // React 18
    import React from 'react';
    import ReactDOM from 'react-dom/client';
    import App from './App';
    
    const root = document.getElementById('root')!;
    
    ReactDOM.createRoot(root).render(<App />);
    
    // å¸è½½ç»„ä»¶
    // åŒæ—¶ï¼Œåœ¨å¸è½½ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°† unmountComponentAtNode å‡çº§ä¸º root.unmount
    
    // React 17
    ReactDOM.unmountComponentAtNode(root);
    
    // React 18
    root.unmount();
    ```
    
    å¦å¤–ï¼Œå¦‚æœä½¿ç”¨äº† `typescript` åˆ™éœ€è¦æ˜¾ç¤ºå®šä¹‰ `props` çš„ `children` å±æ€§äº†
    
    ```tsx
    // React 17
    interface MyButtonProps {
      color: string;
    }
    
    const MyButton: React.FC<MyButtonProps> = ({ children }) => {
      // åœ¨ React 17 çš„ FC ä¸­ï¼Œé»˜è®¤æºå¸¦äº† children å±æ€§
      return <div>{children}</div>;
    };
    
    export default MyButton;
    
    // React 18
    interface MyButtonProps {
      color: string;
      children?: React.ReactNode;
    }
    
    const MyButton: React.FC<MyButtonProps> = ({ children }) => {
      // åœ¨ React 18 çš„ FC ä¸­ï¼Œä¸å­˜åœ¨ children å±æ€§ï¼Œéœ€è¦æ‰‹åŠ¨ç”³æ˜
      return <div>{children}</div>;
    };
    
    export default MyButton;
    ```
    
    é™¤æ­¤ä¹‹å¤–ï¼Œ**`React 18`**Â è¿˜ä»Â **`render`**Â æ–¹æ³•ä¸­åˆ é™¤äº†**`å›è°ƒå‡½æ•°`**ï¼Œå› ä¸ºå½“ä½¿ç”¨**`Suspense`**æ—¶ï¼Œå®ƒé€šå¸¸ä¸ä¼šæœ‰é¢„æœŸçš„ç»“æœã€‚
    
    åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœéœ€è¦åœ¨Â **`render`**Â æ–¹æ³•ä¸­ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­é€šè¿‡Â **`useEffect`**Â å®ç°ï¼š
    
    ```tsx
    // React 17
    const root = document.getElementById('root')!;
    ReactDOM.render(<App />, root, () => {
      console.log('æ¸²æŸ“å®Œæˆ');
    });
    
    // React 18
    const AppWithCallback: React.FC = () => {
      useEffect(() => {
        console.log('æ¸²æŸ“å®Œæˆ');
      }, []);
      return <App />;
    };
    const root = document.getElementById('root')!;
    ReactDOM.createRoot(root).render(<AppWithCallback />)
    ```
    
- `**ConCurrent Mode`  å¹¶å‘æ¨¡å¼**
    
    > CM æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œè€Œæ˜¯ä¸€ä¸ªåº•å±‚è®¾è®¡, æ‰€è°“çš„æ¸²æŸ“å¯ä¸­æ–­
    > 
    
    å¹¶å‘æ¨¡å¼å¯å¸®åŠ©åº”ç”¨ä¿æŒå“åº”ï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„è®¾å¤‡æ€§èƒ½å’Œç½‘é€Ÿè¿›è¡Œé€‚å½“çš„è°ƒæ•´ï¼Œè¯¥æ¨¡å¼é€šè¿‡ä½¿æ¸²æŸ“å¯ä¸­æ–­æ¥ä¿®å¤`é˜»å¡æ¸²æŸ“`é™åˆ¶ã€‚åœ¨Â `Concurrent`Â æ¨¡å¼ä¸­ï¼Œ`React`Â å¯ä»¥åŒæ—¶æ›´æ–°å¤šä¸ªçŠ¶æ€ã€‚
    
    è¯´çš„å¤ªå¤æ‚å¯èƒ½æœ‰ç‚¹æ‹—å£ï¼Œæ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼š
    
    `React 17` å’Œ `React 18` çš„åŒºåˆ«å°±æ˜¯ï¼šä»`åŒæ­¥ä¸å¯ä¸­æ–­æ›´æ–°`å˜æˆäº†`å¼‚æ­¥å¯ä¸­æ–­æ›´æ–°`ã€‚
    
    **åœ¨ `18` ä¸­ï¼Œæ˜¯ä»¥`æ˜¯å¦ä½¿ç”¨å¹¶å‘ç‰¹æ€§`ä½œä¸º`æ˜¯å¦å¼€å¯å¹¶å‘æ›´æ–°`çš„ä¾æ®**ã€‚
    
    å¹¶å‘ç‰¹æ€§: 
    
    - `useTransition` :
        
        ```tsx
        import React, { useState, useEffect, useTransition } from 'react';
        
        const App: React.FC = () => {
          const [list, setList] = useState<any[]>([]);
          const [isPending, startTransition] = useTransition();
          useEffect(() => {
            **// ä½¿ç”¨äº†å¹¶å‘ç‰¹æ€§ï¼Œå¼€å¯å¹¶å‘æ›´æ–°**
            startTransition(() => {
              setList(new Array(10000).fill(null));
            });
          }, []);
          return (
            <>
              {list.map((_, i) => (
                <div key={i}>{i}</div>
              ))}
            </>
          );
        };
        
        export default App;
        ```
        
    - **`useDeferredValue`**
        
        è¿”å›ä¸€ä¸ªå»¶è¿Ÿå“åº”çš„å€¼ï¼Œå¯ä»¥è®©ä¸€ä¸ª**`state`**  å»¶è¿Ÿç”Ÿæ•ˆï¼Œåªæœ‰å½“å‰æ²¡æœ‰ç´§æ€¥æ›´æ–°æ—¶ï¼Œè¯¥å€¼æ‰ä¼šå˜ä¸ºæœ€æ–°å€¼ã€‚**`useDeferredValue`** å’ŒÂ **`startTransition`**ä¸€æ ·ï¼Œéƒ½æ˜¯æ ‡è®°äº†ä¸€æ¬¡éç´§æ€¥æ›´æ–°ã€‚
        
        - ç›¸åŒï¼š`useDeferredValue` æœ¬è´¨ä¸Šå’Œå†…éƒ¨å®ç°ä¸ `useTransition` ä¸€æ ·ï¼Œéƒ½æ˜¯æ ‡è®°æˆäº†`å»¶è¿Ÿæ›´æ–°`ä»»åŠ¡ã€‚
        - ä¸åŒï¼š`useTransition` æ˜¯æŠŠæ›´æ–°ä»»åŠ¡å˜æˆäº†å»¶è¿Ÿæ›´æ–°ä»»åŠ¡ï¼Œè€Œ `useDeferredValue` æ˜¯äº§ç”Ÿä¸€ä¸ªæ–°çš„å€¼ï¼Œè¿™ä¸ªå€¼ä½œä¸ºå»¶æ—¶çŠ¶æ€ã€‚ï¼ˆä¸€ä¸ªç”¨æ¥åŒ…è£…æ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥åŒ…è£…å€¼ï¼‰
        
        ```tsx
        import React, { useState, useEffect, useDeferredValue } from 'react';
        
        const App: React.FC = () => {
          const [list, setList] = useState<any[]>([]);
          useEffect(() => {
            setList(new Array(10000).fill(null));
          }, []);
          // ä½¿ç”¨äº†å¹¶å‘ç‰¹æ€§ï¼Œå¼€å¯å¹¶å‘æ›´æ–°
          const deferredList = useDeferredValue(list);
          return (
            <>
              {deferredList.map((_, i) => (
                <div key={i}>{i}</div>
              ))}
            </>
          );
        };
        
        export default App;
        ```
        
    - æ²¡æœ‰ä½¿ç”¨å¹¶å‘ç‰¹æ€§çš„æ™®é€šæƒ…å†µ
        
        ```tsx
        import React, { useState, useEffect } from 'react';
        
        const App: React.FC = () => {
          const [list, setList] = useState<any[]>([]);
          useEffect(() => {
            setList(new Array(10000).fill(null));
          }, []);
          return (
            <>
              {list.map((_, i) => (
                <div key={i}>{i}</div>
              ))}
            </>
          );
        };
        
        export default App;
        ```
        
    - ç»“è®º: åŸºäº `fiber` å®ç°çš„å¹¶å‘
        - å¹¶å‘æ›´æ–°çš„æ„ä¹‰å°±æ˜¯`äº¤æ›¿æ‰§è¡Œ`ä¸åŒçš„ä»»åŠ¡ï¼Œå½“é¢„ç•™çš„æ—¶é—´ä¸å¤Ÿç”¨æ—¶ï¼Œ`React` å°†çº¿ç¨‹æ§åˆ¶æƒäº¤è¿˜ç»™æµè§ˆå™¨ï¼Œç­‰å¾…ä¸‹ä¸€å¸§æ—¶é—´åˆ°æ¥ï¼Œç„¶åç»§ç»­è¢«ä¸­æ–­çš„å·¥ä½œ
        - `å¹¶å‘æ¨¡å¼`æ˜¯å®ç°`å¹¶å‘æ›´æ–°`çš„åŸºæœ¬å‰æ
        - `æ—¶é—´åˆ‡ç‰‡`æ˜¯å®ç°`å¹¶å‘æ›´æ–°`çš„å…·ä½“æ‰‹æ®µ
        - ä¸Šé¢æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯åŸºäº `fiber` æ¶æ„å®ç°çš„ï¼Œ`fiber`ä¸ºçŠ¶æ€æ›´æ–°æä¾›äº†å¯ä¸­æ–­çš„èƒ½åŠ›
- **`setState`** è‡ªåŠ¨æ‰¹å¤„ç†
    
    [https://www.notion.so/React-9610e7e391874a7e9772e193899906f9#7834679cb81c4b11bf02526cdd1ffcf0](https://www.notion.so/React-9610e7e391874a7e9772e193899906f9)
    
    `React 18` è§£å†³ä¹‹å‰ç‰ˆæœ¬ä¸­, åœ¨setTimeout/åŸç”Ÿäº‹ä»¶ä¸­/ä¸ä¼šè‡ªåŠ¨æ‰¹é‡å¤„ç†çš„ç ´ç»½
    
    - `react18` ä¹‹å‰, è°ƒç”¨ `setState` çš„æƒ…å†µè¯´æ˜
        
        ```tsx
        // åœ¨**React 18 ä¹‹å‰**ï¼Œæˆ‘ä»¬åªåœ¨Â **React äº‹ä»¶å¤„ç†å‡½æ•°**ä¸­è¿›è¡Œæ‰¹å¤„ç†æ›´æ–°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ
        // åœ¨**promise , setTimeoutåŸç”Ÿäº‹ä»¶å¤„ç†å‡½æ•°**ä¸­ã€æˆ–**ä»»ä½•å…¶å®ƒäº‹ä»¶å†…** çš„æ›´æ–°éƒ½ä¸ä¼šè¿›è¡Œæ‰¹å¤„ç†
        // åŸå› : reactæ— æ³•å¤„ç†ä¸Šä¸‹æ–‡ä¸­çš„thisæƒ…å†µ
        import React, { useState } from 'react';
        
        // React 18 ä¹‹å‰
        const App: React.FC = () => {
          console.log('Appç»„ä»¶æ¸²æŸ“äº†ï¼');
          const [count1, setCount1] = useState(0);
          const [count2, setCount2] = useState(0);
          return (
            <button
              onClick={() => {
                setCount1(count => count + 1);
                setCount2(count => count + 1);
                // åœ¨Reactäº‹ä»¶ä¸­è¢«æ‰¹å¤„ç† ç‚¹å‡»ä¸€ä¸‹, æ‰“å°ä¸€æ¬¡ `appç»„ä»¶æ¸²æŸ“äº†`
              }}
            >
              {`count1 is ${count1}, count2 is ${count2}`}
            </button>
          );
        };
        
        export default App;
        
        // react18ä¹‹å‰
        import React, { useState } from 'react';
        
        // React 18 ä¹‹å‰
        const App: React.FC = () => {
          console.log('Appç»„ä»¶æ¸²æŸ“äº†ï¼');
          const [count1, setCount1] = useState(0);
          const [count2, setCount2] = useState(0);
          return (
            <div
              onClick={() => {
                setTimeout(() => {
                  setCount1(count => count + 1);
                  setCount2(count => count + 1);
                });
                // åœ¨ setTimeout ä¸­ä¸ä¼šè¿›è¡Œæ‰¹å¤„ç†, ç‚¹å‡»ä¸€æ¬¡, æ‰“å°ä¸¤æ¬¡ `Appç»„ä»¶æ¸²æŸ“äº†`
              }}
            >
              <div>count1ï¼š {count1}</div>
              <div>count2ï¼š {count2}</div>
            </div>
          );
        };
        
        export default App;
        
        ```
        
    - `react18` ä»»ä½•æƒ…å†µéƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œæ‰¹å¤„ç†ï¼Œå¤šæ¬¡æ›´æ–°å§‹ç»ˆåˆå¹¶ä¸ºä¸€æ¬¡(sync/await é™¤å¤–)
        
        ```tsx
        import React, { useState } from 'react'
        
        function SetState() {
          console.log('Appç»„ä»¶æ¸²æŸ“äº†ï¼')
          const [count1, setCount1] = useState(0)
          const [count2, setCount2] = useState(0)
          return (
            <div
              onClick={async () => {
                await setCount1((count) => count + 1)
                setCount2((count) => count + 1)
              }}
            >
              <div>count1ï¼š {count1}</div>
              <div>count2ï¼š {count2}</div>
            </div>
          )
        }
        
        export default SetState
        ```
        
    - `flushSync` æ‰¹å¤„ç†æ˜¯ä¸€ä¸ª**`ç ´åæ€§æ”¹åŠ¨`**ï¼Œå¦‚æœä½ æƒ³é€€å‡ºæ‰¹é‡æ›´æ–°ï¼Œä½ å¯ä»¥ä½¿ç”¨Â **`flushSync` ä½†æ˜¯**å‡½æ•°å†…éƒ¨å¤šä¸ª `setState` ä»æ˜¯æ‰¹é‡æ›´æ–°
        
        ```tsx
        const click = () => {
            flushSync(() => {
              console.log(1)
              setCount1(count1 + 1)
            })
            console.log(2)
        
            setCount2(count2 + 1)
          }
        // ä¸¤ä¸ªsetCountåˆ†å¼€æ›´æ–°, flushSync å†…éƒ¨çš„setCountæ›´æ–°å®Œæˆå, åœ¨æ‰§è¡Œå¤–é¢çš„setCout, ç»„ä»¶æ›´æ–°ä¸¤æ¬¡
        ```
        
- åˆ é™¤ç»„ä»¶å¸è½½æ—¶çš„è­¦å‘Š
    
    ![è¿™ä¸ªé”™è¯¯è¡¨ç¤ºï¼š**æ— æ³•å¯¹æœªæŒ‚è½½ï¼ˆå·²å¸è½½ï¼‰çš„ç»„ä»¶æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚è¿™æ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œï¼Œå¹¶ä¸”è¡¨æ˜æˆ‘ä»¬çš„ä»£ç ä¸­å­˜åœ¨å†…å­˜æ³„æ¼ã€‚**](React%20068a8677f1874d7d8beabb6002f19b86/Untitled%201.png)
    
    è¿™ä¸ªé”™è¯¯è¡¨ç¤ºï¼š**æ— æ³•å¯¹æœªæŒ‚è½½ï¼ˆå·²å¸è½½ï¼‰çš„ç»„ä»¶æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚è¿™æ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œï¼Œå¹¶ä¸”è¡¨æ˜æˆ‘ä»¬çš„ä»£ç ä¸­å­˜åœ¨å†…å­˜æ³„æ¼ã€‚**
    
    å®é™…ä¸Šï¼Œè¿™ä¸ªé”™è¯¯å¹¶ä¸å¤šè§ï¼Œåœ¨ä»¥å¾€çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªè­¦å‘Šè¢«å¹¿æ³›è¯¯è§£ï¼Œå¹¶ä¸”æœ‰äº›è¯¯å¯¼ã€‚
    
    è¿™ä¸ªé”™è¯¯çš„åˆè¡·ï¼ŒåŸæœ¬æ—¨åœ¨é’ˆå¯¹ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œè­¬å¦‚ `ä½ åœ¨useEffecté‡Œé¢è®¾ç½®äº†å®šæ—¶å™¨ï¼Œæˆ–è€…è®¢é˜…äº†æŸä¸ªäº‹ä»¶ï¼Œä»è€Œåœ¨ç»„ä»¶å†…éƒ¨äº§ç”Ÿäº†å‰¯ä½œç”¨ï¼Œè€Œä¸”å¿˜è®°returnä¸€ä¸ªå‡½æ•°æ¸…é™¤å‰¯ä½œç”¨ï¼Œåˆ™ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼â€¦â€¦` ä¹‹ç±»çš„åœºæ™¯
    
    ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ›´å¤šçš„åœºæ™¯æ˜¯ï¼Œ`æˆ‘ä»¬åœ¨ useEffect é‡Œé¢å‘é€äº†ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œåœ¨å¼‚æ­¥å‡½æ•°è¿˜æ²¡æœ‰è¢« resolve æˆ–è€…è¢« reject çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¸è½½äº†ç»„ä»¶`ã€‚ åœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œè­¦å‘ŠåŒæ ·ä¼šè§¦å‘ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»„ä»¶å†…éƒ¨å¹¶æ²¡æœ‰å†…å­˜æ³„æ¼ï¼Œå› ä¸ºè¿™ä¸ªå¼‚æ­¥å‡½æ•°å·²ç»è¢«åƒåœ¾å›æ”¶äº†ï¼Œæ­¤æ—¶ï¼Œ**è­¦å‘Šå…·æœ‰è¯¯å¯¼æ€§**ã€‚
    
- ç»„ä»¶è¿”å›å€¼æ˜¾ç¤ºè¿”å›undefinedä¸åœ¨æŠ¥é”™(tså¯å¿½ç•¥è­¦å‘Š)
    
    åœ¨Â `React 17`Â ä¸­ï¼Œå¦‚æœä½ éœ€è¦è¿”å›ä¸€ä¸ª`ç©ºç»„ä»¶`ï¼ŒReactåªå…è®¸è¿”å›`null`ã€‚å¦‚æœä½ æ˜¾å¼çš„è¿”å›äº†Â `undefined`ï¼Œæ§åˆ¶å°åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚åœ¨Â `React 18`Â ä¸­ï¼Œä¸å†æ£€æŸ¥å› è¿”å›Â `undefined`Â è€Œå¯¼è‡´å´©æºƒã€‚æ—¢èƒ½è¿”å› `null`ï¼Œä¹Ÿèƒ½è¿”å› `undefined`ï¼ˆä½†æ˜¯ `React 18` çš„`dts`æ–‡ä»¶è¿˜æ˜¯ä¼šæ£€æŸ¥ï¼Œåªå…è®¸è¿”å› `null`ï¼Œä½ å¯ä»¥å¿½ç•¥è¿™ä¸ªç±»å‹é”™è¯¯ï¼‰ã€‚
    
- **Strict Mode (ä¸¥æ ¼æ¨¡å¼)**
    
    ä¸å†æŠ‘åˆ¶æ§åˆ¶å°æ—¥å¿—ï¼š
    
    å½“ä½ ä½¿ç”¨`ä¸¥æ ¼æ¨¡å¼`æ—¶ï¼ŒReact ä¼šå¯¹æ¯ä¸ªç»„ä»¶è¿›è¡Œ`ä¸¤æ¬¡æ¸²æŸ“`ï¼Œä»¥ä¾¿ä½ è§‚å¯Ÿä¸€äº›æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚åœ¨ `React 17` ä¸­ï¼Œå–æ¶ˆäº†`å…¶ä¸­ä¸€æ¬¡æ¸²æŸ“`çš„æ§åˆ¶å°æ—¥å¿—ï¼Œä»¥ä¾¿è®©æ—¥å¿—æ›´å®¹æ˜“é˜…è¯»ã€‚
    
    ä¸ºäº†è§£å†³ç¤¾åŒºå¯¹è¿™ä¸ªé—®é¢˜çš„å›°æƒ‘ï¼Œåœ¨ `React 18` ä¸­ï¼Œå®˜æ–¹å–æ¶ˆäº†è¿™ä¸ªé™åˆ¶ã€‚å¦‚æœä½ å®‰è£…äº†`React DevTools`ï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¥å¿—ä¿¡æ¯å°†æ˜¾ç¤ºä¸ºç°è‰²ï¼Œä»¥æŸ”å’Œçš„æ–¹å¼æ˜¾å¼åœ¨æ§åˆ¶å°ã€‚
    
    [https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7c1a0da9d824e2ba2ef7b9af32fbc91~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7c1a0da9d824e2ba2ef7b9af32fbc91~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)
    
- **Suspense ä¸å†éœ€è¦ fallback æ¥æ•è·**
- é¢å‘ç¬¬ä¸‰æ–¹åº“çš„ `API`
    
    `useSyncExternalStore`  redux åº“
    
    Â æ˜¯ä¸€ä¸ªæ–°çš„apiï¼Œç»å†äº†ä¸€æ¬¡ä¿®æ”¹ï¼Œç”±Â `useMutableSource`Â æ”¹å˜è€Œæ¥ï¼Œä¸»è¦ç”¨æ¥è§£å†³å¤–éƒ¨æ•°æ®æ’•è£‚é—®é¢˜ã€‚
    
    useSyncExternalStore èƒ½å¤Ÿé€šè¿‡å¼ºåˆ¶åŒæ­¥æ›´æ–°æ•°æ®è®© React ç»„ä»¶åœ¨ CM ä¸‹å®‰å…¨åœ°æœ‰æ•ˆåœ°è¯»å–å¤–æ¥æ•°æ®æºã€‚ åœ¨ Concurrent Mode ä¸‹ï¼ŒReact ä¸€æ¬¡æ¸²æŸ“ä¼šåˆ†ç‰‡æ‰§è¡Œï¼ˆä»¥ fiber ä¸ºå•ä½ï¼‰ï¼Œä¸­é—´å¯èƒ½ç©¿æ’ä¼˜å…ˆçº§æ›´é«˜çš„æ›´æ–°ã€‚å‡å¦‚åœ¨é«˜ä¼˜å…ˆçº§çš„æ›´æ–°ä¸­æ”¹å˜äº†å…¬å…±æ•°æ®ï¼ˆæ¯”å¦‚ redux ä¸­çš„æ•°æ®ï¼‰ï¼Œé‚£ä¹‹å‰ä½ä¼˜å…ˆçš„æ¸²æŸ“å¿…é¡»è¦é‡æ–°å¼€å§‹æ‰§è¡Œï¼Œå¦åˆ™å°±ä¼šå‡ºç°å‰åçŠ¶æ€ä¸ä¸€è‡´çš„æƒ…å†µã€‚
    
    `useSyncExternalStore` ä¸€èˆ¬æ˜¯ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“ä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸ä¸šåŠ¡ä¸­ä¸éœ€è¦å…³æ³¨ã€‚å› ä¸º `React` è‡ªèº«çš„ `useState` å·²ç»åŸç”Ÿçš„è§£å†³çš„å¹¶å‘ç‰¹æ€§ä¸‹çš„ `tearï¼ˆæ’•è£‚ï¼‰`é—®é¢˜ã€‚`useSyncExternalStore` ä¸»è¦å¯¹äºæ¡†æ¶å¼€å‘è€…ï¼Œæ¯”å¦‚ `redux`ï¼Œå®ƒåœ¨æ§åˆ¶çŠ¶æ€æ—¶å¯èƒ½å¹¶éç›´æ¥ä½¿ç”¨çš„ `React` çš„ `state`ï¼Œè€Œæ˜¯è‡ªå·±åœ¨å¤–éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª `store` å¯¹è±¡ï¼Œç”¨`å‘å¸ƒè®¢é˜…æ¨¡å¼`å®ç°äº†æ•°æ®æ›´æ–°ï¼Œè„±ç¦»äº† `React` çš„ç®¡ç†ï¼Œä¹Ÿå°±æ— æ³•ä¾é  `React` è‡ªåŠ¨è§£å†³æ’•è£‚é—®é¢˜ã€‚å› æ­¤ `React` å¯¹å¤–æä¾›äº†è¿™æ ·ä¸€ä¸ª APIã€‚
    
    ç›®å‰ `React-Redux 8.0` å·²ç»åŸºäº `useSyncExternalStore` å®ç°ã€‚
    
    **`useInsertionEffect`  css-in-jsåº“**
    
    ```tsx
    const useCSS = rule => {
      useInsertionEffect(() => {
        if (!isInserted.has(rule)) {
          isInserted.add(rule);
          document.head.appendChild(getStyleForRule(rule));
        }
      });
      return rule;
    };
    
    const App: React.FC = () => {
      const className = useCSS(rule);
      return <div className={className} />;
    };
    
    export default App;
    ```
    
- æœåŠ¡ç«¯æ¸²æŸ“
    
    `useId`: 
    
    æ”¯æŒåŒä¸€ä¸ªç»„ä»¶åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç”Ÿæˆç›¸åŒçš„å”¯ä¸€çš„ IDï¼Œé¿å…Â `hydration`Â çš„ä¸å…¼å®¹ï¼Œè¿™è§£å†³äº†åœ¨ `React 17` åŠ `17` ä»¥ä¸‹ç‰ˆæœ¬ä¸­å·²ç»å­˜åœ¨çš„é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬çš„æœåŠ¡å™¨æ¸²æŸ“æ—¶æä¾›çš„ `HTML` æ˜¯`æ— åºçš„`ï¼Œ`useId` çš„åŸç†å°±æ˜¯æ¯ä¸ª `id` ä»£è¡¨è¯¥ç»„ä»¶åœ¨ç»„ä»¶æ ‘ä¸­çš„å±‚çº§ç»“æ„ã€‚